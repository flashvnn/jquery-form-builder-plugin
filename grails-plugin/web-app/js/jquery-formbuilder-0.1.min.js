/*
* jquery-form-builder-plugin - JQuery WYSIWYG Web Form Builder
* http://code.google.com/p/jquery-form-builder-plugin/
*
* Revision: ${svn.info.lastRev}
* Version: 0.1
* Copyright 2011 Lim Chee Kin (limcheekin@vobject.com)
*
* Licensed under Apache v2.0 http://www.apache.org/licenses/LICENSE-2.0.html
*
* Date: ${svn.info.lastDate} 
*/
var FormBuilder={options:{fields:"PlainText, SingleLineText",tabSelected:0,readOnly:false,tabDisabled:[],formCounter:1,language:"en",settings:{en:{name:"Form",classes:["leftAlign"],heading:"h2",styles:{fontFamily:"default",fontSize:"default",fontStyles:[1,0,0]}},zh_CN:{name:"\u8868\u683c",classes:["rightAlign"],heading:"h2",styles:{fontFamily:"default",fontSize:"default",fontStyles:[1,0,0]}},styles:{color:"default",backgroundColor:"default"}},_id:"#container",_languages:["en","zh_CN"],_builderPanel:"#builderPanel",
_builderForm:"#builderForm",_emptyBuilderPanel:"#emptyBuilderPanel",_paletteTabs:"#paletteTabs",_standardFieldsPanel:"#standardFields",_fancyFieldsPanel:"#fancyFields",_fieldSettingsPanel:"#fieldSettings",_fieldSettingsLanguageSection:"#fieldSettings fieldset.language:first",_fieldSettingsGeneralSection:"#fieldSettings div.general:first",_formSettingsLanguageSection:"#formSettings fieldset.language:first",_formSettingsGeneralSection:"#formSettings div.general:first",_languagesSupportIdGeneration:["en"],
_dragBoxCss:{opacity:0.6,zIndex:8888,border:"5px solid #cccccc"},_formControls:"#builderPanel fieldset",_draggableClass:"draggable",_dropPlaceHolderClass:"dropPlaceHolder"},_create:function(){this._log("FormBuilder._create called. this.options.widgets = "+this.options.widgets);this._initBrowserDefaultSettings();this._initBuilderPalette();this._initBuilderPanel()},_initBrowserDefaultSettings:function(){var b=$("html"),a=this.options;a._fontFamily=b.css("fontFamily");a._fontSize=b.css("fontSize");a._color=
b.css("color");a._backgroundColor=b.css("backgroundColor");b=a._fontSize.lastIndexOf("px");if(b>-1)a._fontSize=a._fontSize.substring(0,b)},_initBuilderPalette:function(){$(window).scroll(function(){if($(window).scrollTop()>$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","fixed");$(".floatingPanel").css("top","0")}if($(window).scrollTop()<=$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","relative");$(".floatingPanel").css("top",
$(".floatingPanelIdentifier").position)}});$(this.options._paletteTabs).tabs({selected:this.options.tabSelected,disabled:this.options.tabDisabled,select:this._isFieldSettingsTabCanOpen});var b=this.options.fields;b=b.split(",");var a=b.length,c,d,f;for(f=0;f<a;f++){c=$.fb["fb"+$.trim(b[f])].prototype.options;d=$('<a id="'+c._type+'" href="#" class="fbWidget">'+c.name+"</a>");d.button()["fb"+c._type]().appendTo(c.belongsTo);this._initDraggable(d,c._type)}},_initDraggable:function(b,a){b.draggable({cursor:"move",
distance:10,helper:function(c){c=$(this).data("fb"+a)._createFbWidget(c).css($.fb.formbuilder.prototype.options._dragBoxCss).css({width:$(".formHeading").css("width")}).addClass($.fb.formbuilder.prototype.options._draggableClass);$.fb.formbuilder.prototype._log("helper.html() = "+c.html());return c},drag:function(c,d){$.fb.formbuilder.prototype._log("ui.helper: w x h = "+d.helper.css("width")+" x "+d.helper.css("height"));var f=$.fb.formbuilder.prototype._getPreviousCtrlHolder(d),e=$.fb.formbuilder.prototype.options;
if(f&&f.attr("rel")!=d.helper.attr("rel")){d.helper.attr("rel",f.attr("rel"));$("."+e._dropPlaceHolderClass).remove();$("<div></div>").addClass(e._dropPlaceHolderClass).css("height","30px").insertAfter(f)}else{f=$("."+$.fb.fbWidget.prototype.options._styleClass+":visible:not(."+e._draggableClass+"):first");f.length&&d.offset.top<f.offset().top&&$("."+e._dropPlaceHolderClass).remove()}},stop:function(){$("."+$.fb.formbuilder.prototype.options._dropPlaceHolderClass).remove()}})},_isFieldSettingsTabCanOpen:function(b,
a){if(a.index==1){var c=$.fb.formbuilder.prototype.options,d=true;if($(c._emptyBuilderPanel).is(":visible")){$(c._standardFieldsPanel).qtip({content:"No field was created. Please select standard field or fancy field.",position:{my:"bottom left",at:"top center"},show:{event:false,ready:true,effect:function(){$(this).show("drop",{direction:"up"})}},hide:{target:$(c._standardFieldsPanel+", "+c._fancyFieldsPanel)},style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}});d=false}else if($(c._builderForm+
" ."+$.fb.fbWidget.prototype.options._selectedClass).length===0){$("."+$.fb.fbWidget.prototype.options._styleClass+":first").qtip({content:"Please select field below to see it's Field Settings.",position:{my:"bottom center",at:"top center"},show:{event:false,ready:true,effect:function(){$(this).show("drop",{direction:"up"})}},hide:"click",style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}});d=false}d||$(this).tabs("select",0);return d}},_initBuilderPanel:function(){this._initFormSettings();
if(this.options.readOnly){$("input:not(div.buttons input, #id)").attr("disabled",true);$("select:not(#language)").attr("disabled",true);$("textarea").attr("disabled",true)}else{this._initSortableWidgets();this._initDroppable()}this._initWidgetsEventBinder()},_initDroppable:function(){var b=this.options,a=$(b._formControls);a.droppable({drop:function(c,d){$.fb.formbuilder.prototype._log("drop executing. ui.helper.attr(rel) = "+d.helper.attr("rel")+", ui.offset.top = "+d.offset.top);$.fb.formbuilder.prototype._log("ui.draggable.attr(id) = "+
d.draggable.attr("id"));if(d.helper.attr("class").lastIndexOf(b._draggableClass)>-1){$("."+b._dropPlaceHolderClass).remove();var f=d.draggable.data("fb"+d.draggable.attr("id")),e=$.fb.formbuilder.prototype._getPreviousCtrlHolder(d),h=f._createFbWidget(c);if(e){f._log("$prevCtrlHolder.text() = "+e.text());h.insertAfter(e);e=e.next().nextAll()}else{$(b._emptyBuilderPanel+":visible").hide();e=$("."+$.fb.fbWidget.prototype.options._styleClass+":visible:not(."+b._draggableClass+")",a);a.prepend(h).sortable("refresh")}h.toggle("slide",
{direction:"up"},"slow");if(e.length){f._log("$elements.first().text() = "+e.first().text());$.fb.formbuilder.prototype._getSequence(h).val($.fb.formbuilder.prototype._getSequence(e.first()).val()).change();e.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))})}}}})},_getPreviousCtrlHolder:function(b){var a,c;$("."+$.fb.fbWidget.prototype.options._styleClass+":visible:not(."+$.fb.formbuilder.prototype.options._draggableClass+")").each(function(d){a=$(this);$.fb.formbuilder.prototype._log(d+
") top = "+a.offset().top);if(b.offset.top>a.offset().top)c=a;else return false});return c},_initFormSettings:function(){var b=$.fb.fbWidget.prototype,a=this.options,c=$(a._builderPanel),d=$(a._builderForm),f=$(a._formSettingsLanguageSection),e=$(a._formSettingsGeneralSection),h=$.inArray(a.language,a._languages)>-1?a.language:"en",g=$("#language",f).val(h).change(this._languageChange),i,j=this,l=$(".formHeading",c);h=$("#settings",d);if(h.val()==""){i=a.settings[g.val()];for(h=0;h<a._languages.length;h++)a.settings[a._languages[h]].name+=
" "+a.formCounter;l.addClass(i.classes[0]).append("<"+i.heading+' class="heading">'+i.name+"</"+i.heading+">");$("#name",d).val(b._propertyName(a.settings.en.name));j._updateSettings(j)}else{a.settings=$.parseJSON(unescape(h.val()));i=a.settings[g.val()]}b._log("settings.name = "+i.name);h=b._label({label:"Name",name:"form.name"}).append('<input type="text" id="form.name" value="'+i.name+'" />');$("input",h).keyup(function(){var k=$(this).val();b._log("options.disabledNameChange = "+a.disabledNameChange);
if(!a.disabledNameChange&&$.inArray(g.val(),a._languagesSupportIdGeneration)>-1){var n=b._propertyName(k);$("#name",d).val(n).change()}b._log("$(this).val() = "+k);i.name=k;$(i.heading,l).text(k);j._updateSettings(j)});var m=b._label({label:"Heading",name:"form.heading"}).append('<select> \t\t\t\t<option value="h1">Heading 1</option> \t\t\t\t<option value="h2">Heading 2</option> \t\t\t\t<option value="h3">Heading 3</option> \t\t\t\t<option value="h4">Heading 4</option> \t\t\t\t<option value="h5">Heading 5</option> \t\t\t\t<option value="h6">Heading 6</option> \t\t\t</select>');
$("select",m).val(i.heading).attr("id","form.heading").change(function(){var k=$(this).val(),n=$(i.heading,l).text();n=$("<"+k+' class="heading">'+n+"</"+k+">");i.styles.fontStyles[0]===0&&n.css("fontWeight","normal");i.styles.fontStyles[1]==1&&n.css("fontStyle","italic");i.styles.fontStyles[2]==1&&n.css("textDecoration","underline");$(i.heading,l).replaceWith(n);i.heading=k;j._updateSettings(j)});var o=b._horizontalAlignment({name:"form.horizontalAlignment",value:i.classes[0]});$("select",o).change(function(){var k=
$(this).val();l.removeClass(i.classes[0]).addClass(k);i.classes[0]=k;j._updateSettings(j)});i.styles.fontFamily=i.styles.fontFamily=="default"?a._fontFamily:i.styles.fontFamily;i.styles.fontSize=i.styles.fontSize=="default"?a._fontSize:i.styles.fontSize;var p=b._fontPanel({fontFamily:i.styles.fontFamily,fontSize:i.styles.fontSize,fontStyles:i.styles.fontStyles,idPrefix:"form.",nofieldset:true});$("input[id$='form.bold']",p).change(function(){if($(this).attr("checked")){$(i.heading,l).css("fontWeight",
"bold");i.styles.fontStyles[0]=1}else{$(i.heading,l).css("fontWeight","normal");i.styles.fontStyles[0]=0}j._updateSettings(j)});$("input[id$='form.italic']",p).change(function(){if($(this).attr("checked")){$(i.heading,l).css("fontStyle","italic");i.styles.fontStyles[1]=1}else{$(i.heading,l).css("fontStyle","normal");i.styles.fontStyles[1]=0}j._updateSettings(j)});$("input[id$='form.underline']",p).change(function(){if($(this).attr("checked")){$(i.heading,l).css("textDecoration","underline");i.styles.fontStyles[2]=
1}else{$(i.heading,l).css("textDecoration","none");i.styles.fontStyles[2]=0}j._updateSettings(j)});$("input[id$='form.fontFamily']",p).change(function(){var k=$(this).val();c.css("fontFamily",k);i.styles.fontFamily=k;j._updateSettings(j)});$("select[id$='form.fontSize']",p).change(function(){var k=$(this).val();c.css("fontSize",k+"px");i.styles.fontSize=k;j._updateSettings(j)});if(a.settings.styles.color=="default")a.settings.styles.color=a._color;if(a.settings.styles.backgroundColor=="default")a.settings.styles.backgroundColor=
a._backgroundColor;var q=b._colorPanel({color:a.settings.styles.color,backgroundColor:a.settings.styles.backgroundColor,idPrefix:"form."});$("input[id$='form.color']",q).change(function(){var k=$(this).data("colorPicker").color;c.css("color","#"+k);a.settings.styles.color=k;j._updateSettings(j)});$("input[id$='form.backgroundColor']",q).change(function(){var k=$(this).data("colorPicker").color;j._log("background color change: value "+k);c.css("backgroundColor","#"+k);a.settings.styles.backgroundColor=
k;j._updateSettings(j)});f.append(b._oneColumn(h)).append(b._twoColumns(m,o)).append(p);e.append(q)},_languageChange:function(b){$.fb.formbuilder.prototype._log("languageChange("+$(this).val()+", "+$("option:selected",this).text()+")");var a=$.fb.fbWidget.prototype._getFbOptions(),c=$("."+$.fb.fbWidget.prototype.options._styleClass+":visible"),d=$(this).val(),f=$("option:selected",this).text(),e=a.settings[d],h=$(".formHeading"),g=$(a._formSettingsLanguageSection),i=$(a._builderPanel),j,l,m,o;$("input[id$='form.name']",
g).val(e.name);$("select[id$='form.heading'] option[value='"+e.heading+"']",g).attr("selected","true");var p=$("<"+e.heading+' class="heading">'+e.name+"</"+e.heading+">").css("fontWeight",e.styles.fontStyles[0]==1?"bold":"normal").css("fontStyle",e.styles.fontStyles[1]==1?"italic":"normal").css("textDecoration",e.styles.fontStyles[2]==1?"underline":"none");$(".heading",h).replaceWith(p);$.fb.formbuilder.prototype._log("formSettings.fontStyles[2] = "+e.styles.fontStyles[2]);$("input[id$='form.bold']",
g).attr("checked",e.styles.fontStyles[0]);$("input[id$='form.italic']",g).attr("checked",e.styles.fontStyles[1]);$("input[id$='form.underline']",g).attr("checked",e.styles.fontStyles[2]);h.removeClass("leftAlign centerAlign rightAlign").addClass(e.classes[0]);$("select[id$='form.horizontalAlignment'] option[value='"+e.classes[0]+"']",g).attr("selected","true");e.styles.fontFamily=e.styles.fontFamily=="default"?a._fontFamily:e.styles.fontFamily;e.styles.fontSize=e.styles.fontSize=="default"?a._fontSize:
e.styles.fontSize;i.css("fontFamily",e.styles.fontFamily);i.css("fontSize",e.styles.fontSize+"px");$("select[id$='form.fontSize']",g).val(e.styles.fontSize);$(".fontPicker",g).fontPicker("fontFamily",e.styles.fontFamily);c.each(function(q){var k=$(this);(m=k.attr("class").indexOf($.fb.fbWidget.prototype.options._selectedClass)>-1)&&$(a._fieldSettingsLanguageSection+" legend").text("Language: "+f);if(!k.data("fbWidget")){var n=k.find("input[id$='fields["+k.attr("rel")+"].settings']");k.data("fbWidget",
$.parseJSON(unescape(n.val())))}j=k.data("fbWidget");$.fb.formbuilder.prototype._log(q+") settings = "+j);l=k.find("input[id$='fields["+k.attr("rel")+"].type']").val();$.fb.formbuilder.prototype._log("type = "+l);$this=$("#"+l).data("fb"+l);o={target:$this,item:k,settings:j[d]};(o.item.selected=m)&&$this._createFieldSettings(b,k);$this._languageChange(b,o)})},_updateSettings:function(b){b._log("_updateSettings = "+$.toJSON(b.options.settings));$("#settings").val($.toJSON(b.options.settings)).change()},
_initWidgetsEventBinder:function(){var b=$("."+$.fb.fbWidget.prototype.options._styleClass);if(b.size()>0){var a,c,d=["name","settings","sequence"];$(this.options._emptyBuilderPanel+":visible").hide();b.each(function(f){a=$(this);c=a.find("input[id$='fields["+f+"].type']").val();a.click($.fb["fb"+c].prototype._createFieldSettings);for(var e=0;e<d.length;e++)a.find("input[id$='fields["+f+"]."+d[e]+"']").change($.fb.fbWidget.prototype._updateStatus)});this.options.readOnly||b.find(".closeButton").click($.fb.fbWidget.prototype._deleteWidget).mouseover(function(){$("span",
this).removeClass("ui-icon-close").addClass("ui-icon-circle-close")}).mouseout(function(){$("span",this).removeClass("ui-icon-circle-close").addClass("ui-icon-close")})}},_initSortableWidgets:function(){var b=$(this.options._formControls);b.sortable({axis:"y",cursor:"move",distance:10,helper:function(a,c){return $(c).clone().css($.fb.formbuilder.prototype.options._dragBoxCss)},start:function(a,c){var d=$(c.item).prev();if(d.attr("rel")){c.item.prevIndex=d.attr("rel");c.item.originalOffsetTop=d.offset().top}},
update:$.fb.formbuilder.prototype._updateSequence});b.disableSelection()},_updateSequence:function(b,a){var c=$(a.item),d;d=a.offset.top>a.item.originalOffsetTop;$.fb.formbuilder.prototype._log("moveDown = "+d+", ui.offset.top = "+a.offset.top+", ui.item.originalOffsetTop = "+a.item.originalOffsetTop);if(a.item.prevIndex){var f='[rel="'+a.item.prevIndex+'"]';if(d){d=c.prevUntil(f);$.fb.formbuilder.prototype._moveDown(c,d)}else{$.fb.formbuilder.prototype._getSequence(c).val($.fb.formbuilder.prototype._getSequence(c.next()).val()).change();
d=c.nextUntil(f);d.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))});$.fb.formbuilder.prototype._increaseSequence($(f))}}else{d=c.prevAll();$.fb.formbuilder.prototype._moveDown(c,d)}},_init:function(){this._log("FormBuilder._init called.");this.method1("calling from FormBuilder._init")},destroy:function(){this._log("FormBuilder.destroy called.");$.Widget.prototype.destroy.call(this)},_log:function(b){window.console&&window.console.log&&window.console.log(b)},_moveDown:function(b,
a){$.fb.formbuilder.prototype._getSequence(b).val($.fb.formbuilder.prototype._getSequence(b.prev()).val()).change();a.each(function(){$.fb.formbuilder.prototype._decreaseSequence($(this))})},_getSequence:function(b){return b.find("input[id$='fields["+b.attr("rel")+"].sequence']")},_increaseSequence:function(b){if(b.is(":visible")){b=$.fb.formbuilder.prototype._getSequence(b);b.val(b.val()*1+1);b.change()}},_decreaseSequence:function(b){if(b.is(":visible")){b=$.fb.formbuilder.prototype._getSequence(b);
b.val(b.val()-1);b.change()}},method1:function(b){this._log("FormBuilder.method1 called. params = "+b)}};$.widget("fb.formbuilder",FormBuilder);
var ColorPicker={options:{name:"jquery-color-picker",value:"",ico:"ico.gif",disabledIco:"ico.gif",title:"Pick a colour",inputBG:true,showColorCode:false,speed:500,openTxt:"Open colour picker",type:"basic",width:180,basicColors:["ffffff","ffccc9","ffce93","fffc9e","ffffc7","9aff99","96fffb","cdffff","cbcefb","cfcfcf","fd6864","fe996b","fffe65","fcff2f","67fd9a","38fff8","68fdff","9698ed","c0c0c0","fe0000","f8a102","ffcc67","f8ff00","34ff34","68cbd0","34cdf9","6665cd","9b9b9b","cb0000","f56b00","ffcb2f",
"ffc702","32cb00","00d2cb","3166ff","6434fc","656565","9a0000","ce6301","cd9934","999903","009901","329a9d","3531ff","6200c9","343434","680100","963400","986536","646809","036400","34696d","00009b","303498","000000","330001","643403","663234","343300","013300","003532","010066","340096"],webSafeColors:["000000","000033","000066","000099","0000CC","0000FF","003300","003333","003366","003399","0033CC","0033FF","006600","006633","006666","006699","0066CC","0066FF","009900","009933","009966","009999",
"0099CC","0099FF","00CC00","00CC33","00CC66","00CC99","00CCCC","00CCFF","00FF00","00FF33","00FF66","00FF99","00FFCC","00FFFF","330000","330033","330066","330099","3300CC","3300FF","333300","333333","333366","333399","3333CC","3333FF","336600","336633","336666","336699","3366CC","3366FF","339900","339933","339966","339999","3399CC","3399FF","33CC00","33CC33","33CC66","33CC99","33CCCC","33CCFF","33FF00","33FF33","33FF66","33FF99","33FFCC","33FFFF","660000","660033","660066","660099","6600CC","6600FF",
"663300","663333","663366","663399","6633CC","6633FF","666600","666633","666666","666699","6666CC","6666FF","669900","669933","669966","669999","6699CC","6699FF","66CC00","66CC33","66CC66","66CC99","66CCCC","66CCFF","66FF00","66FF33","66FF66","66FF99","66FFCC","66FFFF","990000","990033","990066","990099","9900CC","9900FF","993300","993333","993366","993399","9933CC","9933FF","996600","996633","996666","996699","9966CC","9966FF","999900","999933","999966","999999","9999CC","9999FF","99CC00","99CC33",
"99CC66","99CC99","99CCCC","99CCFF","99FF00","99FF33","99FF66","99FF99","99FFCC","99FFFF","CC0000","CC0033","CC0066","CC0099","CC00CC","CC00FF","CC3300","CC3333","CC3366","CC3399","CC33CC","CC33FF","CC6600","CC6633","CC6666","CC6699","CC66CC","CC66FF","CC9900","CC9933","CC9966","CC9999","CC99CC","CC99FF","CCCC00","CCCC33","CCCC66","CCCC99","CCCCCC","CCCCFF","CCFF00","CCFF33","CCFF66","CCFF99","CCFFCC","CCFFFF","FF0000","FF0033","FF0066","FF0099","FF00CC","FF00FF","FF3300","FF3333","FF3366","FF3399",
"FF33CC","FF33FF","FF6600","FF6633","FF6666","FF6699","FF66CC","FF66FF","FF9900","FF9933","FF9966","FF9999","FF99CC","FF99FF","FFCC00","FFCC33","FFCC66","FFCC99","FFCCCC","FFCCFF","FFFF00","FFFF33","FFFF66","FFFF99","FFFFCC","FFFFFF"],customColors:[],disabled:false},_init:function(){var b=this.options.disabled?this.options.disabledIco:this.options.ico;this._log("ColorPicker._init called.");this.element.append('<input type="text" id="'+this.options.name+'" name="'+this.options.name+'" /> \t\t\t\t<a class="floatLeft" href="#" rel="'+
this.options.name+'"> \t\t\t\t<img border="0" src="'+b+'" alt="'+this.options.openTxt+'"/></a>');b=$("input",this.element).attr("readonly",true);var a=this.element.data("colorPicker"),c="colorpicker_"+this.options.type;a.options.showColorCode?b.val(this.options.value):b.attr("disabled","true");b.data("colorPicker",{color:this.options.value});var d=$("#"+c);if(d.length==0&&!this.options.disabled){for(var f="",e=this.options[this.options.type+"Colors"],h,g=0;g<e.length;g++){h=e[g];if(h!="")f+='<li><a href="#" title="'+
h+'" rel="'+h+'" style="background: #'+h+"; color: "+this._hexInvert(h)+';">'+h+"</a></li>"}d=$('<div id="'+c+'" class="colorPicker">'+(this.options.title?"<h2>"+this.options.title+"</h2>":"")+"<ul>"+f+"</ul></div>").appendTo(document.body).hide();$(document.body).click(function(j){$(j.target).is(".colorPicker")||$(j.target).parents(".colorPicker").length||d.hide(a.options.speed)})}if(this.options.inputBG){c=this.options.value;if(c.length==6)c="#"+c;b.css({background:c,color:"#"+this._hexInvert(c)})}if(!this.options.disabled){var i=
$("a",this.element);i.click(function(){var j=i.offset();d.css({position:"absolute",left:j.left+"px",top:j.top+"px",width:a.options.width+"px"}).show(a.options.speed).attr("rel",i.attr("rel"));return false})}$("a",d).click(function(j){var l=$("input[id$='"+d.attr("rel")+"']"),m=$(this).attr("rel");$.fb.colorPicker.prototype._log("colorPicker. input id = "+d.attr("rel")+", hex = "+m+", title = "+$(this).attr("title")+", text = "+$(this).text());var o=l.parent().data("colorPicker").options;o.showColorCode&&
l.val(m);l.data("colorPicker",{color:m});o.inputBG&&l.css({background:"#"+m,color:"#"+a._hexInvert(m)});l.change();d.hide(a.options.speed);j.stopImmediatePropagation();return false})},_log:function(b){window.console&&window.console.log&&window.console.log(b)},_hexInvert:function(b){var a=b.substr(0,2),c=b.substr(2,2);b=b.substr(4,2);return 0.212671*a+0.71516*c+0.072169*b<0.5?"ffffff":"000000"}};$.widget("fb.colorPicker",ColorPicker);
var FontPicker={fonts:Array("Arial,Arial,Helvetica,sans-serif","Arial Black,Arial Black,Gadget,sans-serif","Comic Sans MS,Comic Sans MS,cursive","Courier New,Courier New,Courier,monospace","Georgia,Georgia,serif","Impact,Charcoal,sans-serif","Lucida Console,Monaco,monospace","Lucida Sans Unicode,Lucida Grande,sans-serif","Palatino Linotype,Book Antiqua,Palatino,serif","Tahoma,Geneva,sans-serif","Times New Roman,Times,serif","Trebuchet MS,Helvetica,sans-serif","Verdana,Geneva,sans-serif"),options:{defaultFont:"Tahoma",
id:"fontbox",name:"fontPickerInput",selClass:"fontPicker",fontclass:"singlefont",speed:100,hoverColor:"#efefff",bgColor:"#ffffee",disabled:false},_log:function(b){window.console&&window.console.log&&window.console.log(b)},_init:function(){var b=this.options,a=$("#"+b.id);this.element.parent().append('<input type="hidden" id="'+b.name+'" />');if(!a.length&&!b.disabled){a=$('<div id="'+b.id+'" ></div>').appendTo(document.body).hide();$.each(this.fonts,function(c,d){a.append('<div class="singlefont" onmouseover="this.style.backgroundColor=\''+
b.hoverColor+"'\" onmouseout=\"this.style.backgroundColor='"+b.bgColor+'\'" style="font-family: '+d+';" value="'+d+'"> '+d.split(",")[0]+"</div>")});$(document.body).click(function(c){$(c.target).is("."+b.selClass)||$(c.target).is("#"+b.id)||a.slideUp(b.speed)})}b.disabled||this.element.click(function(){if(a.is(":hidden")){var c=$(this);a.css({position:"absolute",left:c.offset().left+"px",top:c.offset().top+c.height()+3+"px"}).attr("rel",c.attr("rel"));a.slideDown(b.speed)}else a.slideUp(b.speed)});
b.defaultFont.length&&this.fontFamily(b.defaultFont);$("."+b.fontclass).click(function(c){var d=$(this),f=$("input[id$='"+d.parent().attr("rel")+"']"),e=d.attr("value");f.prev().text(d.text()).css("fontFamily",e);f.val(e).change();a.slideUp(b.speed);c.stopImmediatePropagation()})},fontFamily:function(b){this._log("fontFamily("+b+")");b=b.replace(/'/gi,"");var a=b.split(",",1)[0];this._log("fontFamilyValue = "+b+", fontFamilyText = "+a);this.element.text(a).css("fontFamily",b);$("input",this.element.parent()).val(b)}};
$.widget("fb.fontPicker",FontPicker);
var FbWidget={options:{_styleClass:"ctrlHolder",_selectedClass:"ctrlHolderSelected"},_log:function(b){window.console&&window.console.log&&window.console.log(b)},_create:function(){this._log("FbWidget._create called.")},_init:function(){this._log("FbWidget._init called.");this.element.click(this._createFbWidget)},destroy:function(){this._log("FbWidget.destroy called.");this.element.button("destroy");$.Widget.prototype.destroy.call(this)},_getFbOptions:function(){return $($.fb.formbuilder.prototype.options._id).formbuilder("option")},_getFbLocalizedSettings:function(){return $($.fb.formbuilder.prototype.options._id).formbuilder("option").settings[$("#language").val()]},
_createField:function(b,a,c,d){var f=$.fb.formbuilder.prototype.options,e=$("#builderForm div.ctrlHolder").size();$('<a class="ui-corner-all closeButton" href="#"><span class="ui-icon ui-icon-close">delete this widget</span></a>').prependTo(a).click($.fb.fbWidget.prototype._deleteWidget).mouseover(function(){$("span",this).removeClass("ui-icon-close").addClass("ui-icon-circle-close")}).mouseout(function(){$("span",this).removeClass("ui-icon-circle-close").addClass("ui-icon-close")});a.attr("rel",
e);a.append($.fb.fbWidget.prototype._createFieldProperties(b,c,d,e));$(f._emptyBuilderPanel+":visible").hide()},_propertyName:function(b){b=b.replace(/ /gi,"");return b=b.charAt(0).toLowerCase()+b.substring(1)},_deleteWidget:function(b){var a=$(b.target).parent().parent(),c=a.attr("rel"),d=$.fb.fbWidget.prototype.options,f=$.fb.formbuilder.prototype.options;if(a.find("input[id$='fields["+c+"].id']").val()=="null")a.remove();else{a.find("input[id$='fields["+c+"].status']").val("D");a.hide()}c=$("."+
d._styleClass+":visible");$.fb.fbWidget.prototype._log("_deleteWidget(). $ctrlHolders.size() = "+c.size());a.attr("class").indexOf(d._selectedClass)>-1&&$(f._paletteTabs).tabs("select",0);c.size()===0&&$(f._emptyBuilderPanel).show();b.stopPropagation()},_createFieldProperties:function(b,a,c,d){var f="fields["+d+"].";b=$('<div class="fieldProperties"> \t\t<input type="hidden" id="'+f+'id" name="'+f+'id" value="null" /> \t\t<input type="hidden" id="'+f+'name" name="'+f+'name" value="'+b+'" /> \t\t<input type="hidden" id="'+
f+'type" name="'+f+'type" value="'+a._type+'" /> \t\t<input type="hidden" id="'+f+'settings" name="'+f+'settings" /> \t\t<input type="hidden" id="'+f+'sequence" name="'+f+'sequence" value="'+d+'" /> \t\t<input type="hidden" id="'+f+'status" name="'+f+'status" /> \t\t</div>');b.find("input[id$='"+f+"settings']").val($.toJSON(c));return b},_updateStatus:function(b){$widget=$(b.target);$.fb.fbWidget.prototype._log($widget.attr("id")+" updated");if($widget.parent().find("input:first").val()!="null"){$.fb.fbWidget.prototype._log("field status updated");
$widget.parent().find("input:last").val("U")}},_createFbWidget:function(b){$.fb.fbWidget.prototype._log("_createFbWidget executing. event.type = "+b.type);var a;if(this.options)a=this;else{a="fb"+$(this).fbWidget("option","_type");$.fb.fbWidget.prototype._log("type = "+a);a=$(this).data(a)}for(var c=jQuery.extend(true,{},a.options.settings),d=a._getCounter(a),f=a.options._languages,e=0;e<f.length;e++){c[f[e]][a.options._counterField]+=" "+d;a._log(c[f[e]][a.options._counterField])}f=$('<div class="'+
a.options._styleClass+'"></div>').hide();f.data("fbWidget",c);a._log("b4. text = "+c[$("#language").val()].text);e={target:a,item:f,settings:c[$("#language").val()],_settings:c};e=a._getWidget(b,e);a._log("at. text = "+c[$("#language").val()].text);f.append(e);if(b.type=="click"||b.type=="drop"){d=a._propertyName(a.options._type+d);e.click(a._createFieldSettings);a._createField(d,f,a.options,c);if(b.type=="click"){$($.fb.formbuilder.prototype.options._formControls).append(f).sortable("refresh");f.toggle("slide",
{direction:"up"},"slow");a._scroll(b);b.preventDefault()}else return f}else return f.show();a._log("_createFbWidget executed")},_scroll:function(){var b=$($.fb.formbuilder.prototype.options._builderPanel);this._log("builderPanel: min-height = "+b.css("minHeight")+", height = "+b.css("height"));var a=b.css("minHeight");b=b.css("height");a=a.substring(0,a.lastIndexOf("px"))*1;b=b.substring(0,b.lastIndexOf("px"))*1;if(b>a){this._log("builderPanel: scrolling... height: "+b+", minHeight: "+a);a=b-a;this._log("y = "+
a);$("html, body").stop().animate({scrollTop:a},1500,"easeInOutExpo")}},_createFieldSettings:function(b,a){$.fb.fbWidget.prototype._log("_createFieldSettings executing.");a||(a=$(this));var c=$.fb.fbWidget.prototype.options._selectedClass;a=a.attr("class").indexOf($.fb.fbWidget.prototype.options._styleClass)>-1?a:a.parent();a.parent().find("."+c).removeClass(c);a.addClass(c);c=a.find("input[id$='fields["+a.attr("rel")+"].type']").val();$.fb.fbWidget.prototype._log("type = "+c);c=$("#"+c).data("fb"+
c);var d=c._getFbOptions();c._log("$widget.text() = "+a.text()+", fbOptions.readOnly = "+d.readOnly);if(!a.data("fbWidget")){var f=a.find("input[id$='fields["+a.attr("rel")+"].settings']");c._log("_createFieldSettings. unescaped settings = "+unescape(f.val()));a.data("fbWidget",$.parseJSON(unescape(f.val())))}f=a.data("fbWidget");var e=$(d._fieldSettingsLanguageSection),h=$("#language");$("legend",e).text("Language: "+h.find("option:selected").text());h={target:c,item:a,settings:f[h.val()]};h=c._getFieldSettingsLanguageSection(b,
h);e.children(":not(legend)").remove();for(var g=0;g<h.length;g++)e.append(h[g]);h=c._getFieldSettingsGeneralSection(b,{target:c,item:a,settings:f});c._log("fieldSettings.length = "+h.length);f=$(d._fieldSettingsGeneralSection);f.children().remove();for(g=0;g<h.length;g++){c._log(h[g].html());f.append(h[g])}if(d.readOnly){var i=$(d._fieldSettingsPanel);$("input",i).attr("disabled",true);$("select",i).attr("disabled",true);$("textarea",i).attr("disabled",true)}$.fb.fbWidget.prototype._log("_createFieldSettings. event.type = "+
b.type);if(b.type=="click"){$(d._paletteTabs).tabs("select",1);$("input:first",i).select()}$.fb.fbWidget.prototype._log("_createFieldSettings executed.")},_getCounter:function(b){var a=$("."+b.options._styleClass+":visible:not(."+this._getFbOptions()._draggableClass+")"),c=1;if(a.size()>0){var d,f,e,h=0,g=b._propertyName(b.options._type);a.each(function(){d=$(this);f=d.attr("rel");e=d.find("input[id$='fields["+f+"].name']").val();if(e.indexOf(g)>-1){h=e.substring(g.length)*1;b._log("widgetCounter = "+
h);if(h>c)c=h}});h>0&&c++}b._log("counter = "+c);return c},_updateSettings:function(b){var a=b.data("fbWidget");this._log("_updateSettings: \n"+$.toJSON(a));b.find("input[id$='fields["+b.attr("rel")+"].settings']").val($.toJSON(a)).change()},_updateName:function(b,a){var c=this._getFbOptions(),d=c.disabledNameChange,f=b.attr("rel");if(d){this._log("_updateName. id == null: "+(b.find("input[id$='fields["+f+"].id']").val()!="null"));d=b.find("input[id$='fields["+f+"].id']").val()!="null"}if(!d&&$.inArray($("#language").val(),
c._languagesSupportIdGeneration)>-1){c=this._propertyName(a);b.find("input[id$='fields["+f+"].name']").val(c).change()}},_threeColumns:function(b,a,c){return $('<div class="threeCols"></div>').append(b.addClass("col1")).append(a.addClass("col2")).append(c.addClass("col3"))},_twoColumns:function(b,a){return $('<div class="twoCols"></div>').append(b.addClass("labelOnTop col1 noPaddingBottom")).append(a.addClass("labelOnTop col2"))},_oneColumn:function(b){return b.addClass("clear labelOnTop")},_help:function(b){var a;
if(b.description){a=$('<span>&nbsp;(<a href="#" title="'+b.description+'">?</a>)</span>');b=$("a",a);b.qtip({content:b.attr("title"),position:{my:"bottom left",at:"top center"},show:{event:"click",effect:function(){$(this).show("drop",{direction:"up"})}},hide:"mouseout",style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}})}return a},_label:function(b){var a=$('<div><label for="'+b.name+'">'+b.label+"</label></div>").append(this._help(b));b.nobreak||a.append("<br />");return a},
_horizontalAlignment:function(b){b=$.extend({},b);b.label=b.label?b.label:"Horizontal Align";var a=this._label(b).append('<select> \t\t\t<option value="leftAlign">left</option> \t\t\t<option value="centerAlign">center</option> \t\t\t<option value="rightAlign">right</option> \t\t</select>');$("select",a).val(b.value).attr("id",b.name);return a},_verticalAlignment:function(b){b=$.extend({},b);b.label=b.label?b.label:"Vertical Align";var a=this._label(b).append('<select> \t\t\t\t<option value="topAlign">top</option> \t\t\t\t<option value="middleAlign">middle</option> \t\t\t\t<option value="bottomAlign">bottom</option> \t\t\t</select></div>');
$("select",a).val(b.value).attr("id",b.name);return a},_name:function(b){var a=b.attr("rel"),c=$('<label for="field.name">Name (?)</label><br/>  \t\t\t\t  <input type="text" id="field.name" />');$("input[id$='field.name']",c).val(b.find("input[id$='fields["+a+"].name']").val()).keyup(function(d){b.find("input[id$='fields["+a+"].name']").val($(d.target).val()).change()});return c},_colorPicker:function(b){var a;a=b.label?this._label(b):$("<div></div>");!b.type||b.type=="basic"?a.colorPicker({name:b.name,
value:b.value,ico:"../images/jquery.colourPicker.gif",disabledIco:"../images/jquery.colourPicker.disabled.gif",title:"Basic Colors",disabled:this._getFbOptions().readOnly}):a.colorPicker({name:name,value:value,ico:"../images/jquery.colourPicker.gif",disabledIco:"../images/jquery.colourPicker.disabled.gif",title:"Web Safe Colors",type:"webSafe",width:360,disabled:this._getFbOptions().readOnly});return a},_fontPicker:function(b){b=$.extend({},b);this._log("fontPicker("+$.toJSON(b)+")");b.value=b.value!=
"default"?b.value:this._getFbOptions()._fontFamily;if(!b.label)b.label="Font";var a=this._label(b).append('<div class="fontPicker" rel="'+b.name+'"></div>');$(".fontPicker",a).fontPicker({name:b.name,defaultFont:b.value,disabled:this._getFbOptions().readOnly});return a},_fontSize:function(b){this._log("fontSize("+$.toJSON(b)+")");b.nobreak=true;var a=this._label(b).append('&nbsp;<select> \t\t    <option value="9">9</option> \t\t    <option value="10">10</option> \t\t    <option value="11">11</option> \t\t    <option value="12">12</option> \t\t    <option value="13">13</option> \t\t    <option value="14">14</option> \t\t    <option value="15">15</option> \t\t    <option value="16">16</option> \t\t    <option value="17">17</option> \t\t    <option value="18">18</option> \t\t    <option value="20">20</option> \t\t    <option value="22">22</option> \t\t    <option value="24">24</option> \t\t    <option value="28">28</option> \t\t    <option value="32">32</option> \t\t  </select>'),
c=$("select",a);b.value=="default"?c.val(this._getFbOptions().settings.styles.fontSize):c.val(b.value);c.attr("id",b.name);return a},_fontStyles:function(b){var a=b.names;b=b.checked;var c=$('<div> \t\t  <input type="checkbox" id="'+a[0]+'" />&nbsp;Bold<br /> \t    <input type="checkbox" id="'+a[1]+'" />&nbsp;Italic<br /> \t    <input type="checkbox" id="'+a[2]+'" />&nbsp;Underline \t  </div>');if(b)for(var d=0;d<b.length;d++)$("input[id$='"+a[d]+"']",c).attr("checked",b[d]);return c},_twoRowsOneRow:function(b,
a,c){var d=$('<div class="twoRowsOneRow"> \t\t\t    <div class="row1col1"> \t\t\t      <div class="row2col1"> \t\t\t      </div> \t\t\t    </div> \t\t\t    <div class="row1col2"> \t\t\t    </div> \t\t\t  </div>');$(".row1col1",d).prepend(b);$(".row2col1",d).append(a);$(".row1col2",d).append(c);return d},_fieldset:function(b){return $("<fieldset><legend>"+b.text+"</legend></fieldset>")},_fontPanel:function(b){var a=b.idPrefix?b.idPrefix:"",c=[a+"bold",a+"italic",a+"underline"];a=this._twoRowsOneRow(this._fontPicker({name:a+
"fontFamily",value:b.fontFamily}),this._fontSize({label:"Size",name:a+"fontSize",value:b.fontSize}),this._fontStyles({names:c,checked:b.fontStyles}).css("paddingLeft","2em"));return b.nofieldset?a:this._fieldset({text:"Fonts"}).append(a)},_colorPanel:function(b){b=$.extend({},b);b.idPrefix=b.idPrefix?b.idPrefix:"";if(b.color=="default")b.color=this._getFbOptions().settings.styles.color;if(b.backgroundColor=="default")b.backgroundColor=this._getFbOptions().settings.styles.backgroundColor;b=this._fieldset({text:"Colors"}).append(this._twoColumns(this._colorPicker({label:"Text",
name:b.idPrefix+"color",value:b.color}),this._colorPicker({label:"Background",name:b.idPrefix+"backgroundColor",value:b.backgroundColor})));b.find(".2cols .col2").addClass("noPaddingBottom");b.find("input:first").addClass("floatClearLeft");return b},_labelValueDescriptionColorPanel:function(b){b=$.extend({},b);var a=this._getFbOptions().settings.styles;if(b.label.color=="default")b.label.color=a.color;if(b.label.backgroundColor=="default")b.label.backgroundColor=a.backgroundColor;if(b.description.color==
"default")b.description.color=a.color;if(b.description.backgroundColor=="default")b.description.backgroundColor=a.backgroundColor;b=this._fieldset({text:"Colors"}).append(this._threeColumns($("<div></div>"),$("<div>Text</div>"),$("<div>Background</div>")).css("paddingBottom","2px")).append(this._threeColumns($("<div>Label</div>"),this._colorPicker({name:"field.label.color",value:b.label.color}),this._colorPicker({name:"field.label.backgroundColor",value:b.label.backgroundColor}))).append(this._threeColumns($("<div>Value</div>"),
this._colorPicker({name:"field.value.color",value:b.value.color}),this._colorPicker({name:"field.value.backgroundColor",value:b.value.backgroundColor}))).append(this._threeColumns($("<div>Description</div>"),this._colorPicker({name:"field.description.color",value:b.description.color}),this._colorPicker({name:"field.description.backgroundColor",value:b.description.backgroundColor})));b.css("paddingTop","0.5em");$("input",b).addClass("floatClearLeft");$(".col1",b).css("verticalAlign","top");return b},
_getWidget:function(){$.fb.fbWidget.prototype._log("getWidget(event, fb) should be overriden by subclass.")},_getFieldSettingsLanguageSection:function(){$.fb.fbWidget.prototype._log("getFieldSettingsLanguageSection(event, fb) should be overriden by subclass.")},_getFieldSettingsGeneralSection:function(){$.fb.fbWidget.prototype._log("getFieldSettingsLanguageSection(event, fb) should be overriden by subclass.")},_languageChange:function(){$.fb.fbWidget.prototype._log("_languageChange(event, fb) should be overriden by subclass.")}};
$.widget("fb.fbWidget",FbWidget);
var FbPlainText=$.extend({},$.fb.fbWidget.prototype,{options:{name:"Plain Text",belongsTo:$.fb.formbuilder.prototype.options._fancyFieldsPanel,_type:"PlainText",_html:'<div class="PlainText"></div>',_counterField:"text",_languages:["en","zh_CN"],settings:{en:{text:"Plain Text",classes:["leftAlign","topAlign"],styles:{fontFamily:"default",fontSize:"default",fontStyles:[0,0,0]}},zh_CN:{text:"\u65e0\u683c\u5f0f\u6587\u5b57",classes:["rightAlign","middleAlign"],styles:{fontFamily:"default",fontSize:"default",
fontStyles:[0,0,0]}},styles:{color:"default",backgroundColor:"default"}}},_init:function(){$.fb.fbWidget.prototype._init.call(this);this.options=$.extend({},$.fb.fbWidget.prototype.options,this.options)},_getWidget:function(b,a){a.item.addClass(a.settings.classes[1]);return $(a.target.options._html).text(a.settings.text).addClass(a.settings.classes[0])},_getFieldSettingsLanguageSection:function(b,a){var c=a.target._label({label:"Text",name:"field.text",description:"Text entered below will display in the form."}).append('<input type="text" id="field.text" />');
$("input",c).val(a.settings.text).keyup(function(){var g=$(this).val();a.item.find("div.PlainText").text(g);a.settings.text=g;a.target._updateSettings(a.item)});var d=a.target._verticalAlignment({name:"field.verticalAlignment",value:a.settings.classes[1]}).change(function(){var g=$("option:selected",this).val();a.target._log("field.verticalAlignment value = "+g);a.item.removeClass(a.settings.classes[1]).addClass(g);a.settings.classes[1]=g;a.target._updateSettings(a.item)}),f=a.target._horizontalAlignment({name:"field.horizontalAlignment",
value:a.settings.classes[0]}).change(function(){a.target._log("$horizontalAlignment change trigger");var g=a.item.find("div.PlainText"),i=$("option:selected",this).val();g.removeClass(a.settings.classes[0]).addClass(i);a.settings.classes[0]=i;a.target._updateSettings(a.item)}),e=a.settings.styles,h=a.target._getFbLocalizedSettings().styles;h=a.target._fontPanel({fontFamily:e.fontFamily!="default"?e.fontFamily:h.fontFamily,fontSize:e.fontSize!="default"?e.fontSize:h.fontSize,fontStyles:e.fontStyles,
idPrefix:"field.",nofieldset:true});$("input[id$='field.bold']",h).change(function(){var g=a.item.find(".PlainText");if($(this).attr("checked")){g.css("fontWeight","bold");e.fontStyles[0]=1}else{g.css("fontWeight","normal");e.fontStyles[0]=0}a.target._updateSettings(a.item)});$("input[id$='field.italic']",h).change(function(){var g=a.item.find(".PlainText");if($(this).attr("checked")){g.css("fontStyle","italic");e.fontStyles[1]=1}else{g.css("fontStyle","normal");e.fontStyles[1]=0}a.target._updateSettings(a.item)});
$("input[id$='field.underline']",h).change(function(){var g=a.item.find(".PlainText");if($(this).attr("checked")){g.css("textDecoration","underline");e.fontStyles[2]=1}else{g.css("textDecoration","none");e.fontStyles[2]=0}a.target._updateSettings(a.item)});$("input[id$='field.fontFamily']",h).change(function(){var g=$(this).val();a.item.find(".PlainText").css("fontFamily",g);e.fontFamily=g;a.target._updateSettings(a.item)});$("select[id$='field.fontSize']",h).change(function(){var g=$(this).val();
a.item.find(".PlainText").css("fontSize",g+"px");e.fontSize=g;a.target._updateSettings(a.item)});return[a.target._oneColumn(c),a.target._twoColumns(f,d),h]},_getFieldSettingsGeneralSection:function(b,a){var c=a.settings.styles,d=a.target._getFbOptions().settings.styles;d=a.target._colorPanel({color:c.color!="default"?c.color:d.color,backgroundColor:c.backgroundColor!="default"?c.backgroundColor:d.backgroundColor,idPrefix:"field."});$("input[id$='field.color']",d).change(function(){var f=$(this).data("colorPicker").color;
a.item.css("color","#"+f);c.color=f;a.target._updateSettings(a.item)});$("input[id$='field.backgroundColor']",d).change(function(){var f=$(this).data("colorPicker").color;a.item.css("backgroundColor","#"+f);c.backgroundColor=f;a.target._updateSettings(a.item)});return[d]},_languageChange:function(b,a){this._log("languageChange = "+$.toJSON(a.settings));var c=a.settings.styles,d=a.target._getFbLocalizedSettings().styles,f=c.fontFamily!="default"?c.fontFamily:d.fontFamily;d=c.fontSize!="default"?c.fontSize:
d.fontSize;a.item.find(".PlainText").text(a.settings.text).removeClass("leftAlign centerAlign rightAlign").addClass(a.settings.classes[0]);a.item.css("fontWeight",c.fontStyles[0]==1?"bold":"normal").css("fontStyle",c.fontStyles[1]==1?"italic":"normal").css("textDecoration",c.fontStyles[2]==1?"underline":"none").css("fontFamily",f).css("fontSize",d+"px").removeClass("topAlign middleAlign bottomAlign").addClass(a.settings.classes[1])}});$.widget("fb.fbPlainText",FbPlainText);
var FbSingleLineText=$.extend({},$.fb.fbWidget.prototype,{options:{name:"Single Line Text",belongsTo:$.fb.formbuilder.prototype.options._standardFieldsPanel,_type:"SingleLineText",_html:'<div><label><em></em><span></span></label> \t\t      <input type="text" class="textInput" /> \t        <p class="formHint"></p></div>',_counterField:"label",_languages:["en","zh_CN"],settings:{en:{label:"Single Line Text",value:"",description:"",styles:{fontFamily:"default",fontSize:"default",fontStyles:[0,0,0]}},
zh_CN:{label:"\u5355\u884c\u6587\u5b57\u8f93\u5165",value:"",description:"",styles:{fontFamily:"default",fontSize:"default",fontStyles:[0,0,0]}},_persistable:true,required:true,restriction:"no",styles:{label:{color:"default",backgroundColor:"default"},value:{color:"default",backgroundColor:"default"},description:{color:"777777",backgroundColor:"default"}}}},_init:function(){$.fb.fbWidget.prototype._init.call(this);this.options=$.extend({},$.fb.fbWidget.prototype.options,this.options)},_getWidget:function(b,
a){var c=$(a.target.options._html);a.target._log("fbSingleLineText._getWidget executing...");$("label span",c).text(a.settings.label);a._settings.required&&$("label em",c).text("*");$("input",c).val(a.settings.value);$(".formHint",c).text(a.settings.description);a.target._log("fbSingleLineText._getWidget executed.");return c},_getFieldSettingsLanguageSection:function(b,a){a.target._log("fbSingleLineText._getFieldSettingsLanguageSection executing...");var c=a.target._label({label:"Label",name:"field.label"}).append('<input type="text" id="field.label" />');
$("input",c).val(a.settings.label).keyup(function(){var g=$(this).val();a.item.find("label span").text(g);a.settings.label=g;a.target._updateSettings(a.item);a.target._updateName(a.item,g)});var d=a.target._label({label:"Value",name:"field.value"}).append('<input type="text" id="field.value" />');$("input",d).val(a.settings.value).keyup(function(){var g=$(this).val();a.item.find(".textInput").val(g);a.settings.value=g;a.target._updateSettings(a.item)});var f=a.target._label({label:"Description",name:"field.description"}).append('<textarea id="field.description" rows="2"></textarea>');
$("textarea",f).val(a.settings.description).keyup(function(){var g=$(this).val();a.item.find(".formHint").text(g);a.settings.description=g;a.target._updateSettings(a.item)});var e=a.settings.styles,h=a.target._getFbLocalizedSettings().styles;h=a.target._fontPanel({fontFamily:e.fontFamily!="default"?e.fontFamily:h.fontFamily,fontSize:e.fontSize!="default"?e.fontSize:h.fontSize,fontStyles:e.fontStyles,idPrefix:"field.",nofieldset:true});$("input[id$='field.bold']",h).change(function(){if($(this).attr("checked")){a.item.find("label").css("fontWeight",
"bold");a.item.find(".textInput").css("fontWeight","bold");e.fontStyles[0]=1}else{a.item.find("label").css("fontWeight","normal");a.item.find(".textInput").css("fontWeight","normal");e.fontStyles[0]=0}a.target._updateSettings(a.item)});$("input[id$='field.italic']",h).change(function(){if($(this).attr("checked")){a.item.find("label").css("fontStyle","italic");a.item.find(".textInput").css("fontStyle","italic");e.fontStyles[1]=1}else{a.item.find("label").css("fontStyle","normal");a.item.find(".textInput").css("fontStyle",
"normal");e.fontStyles[1]=0}a.target._updateSettings(a.item)});$("input[id$='field.underline']",h).change(function(){if($(this).attr("checked")){a.item.find("label span").css("textDecoration","underline");a.item.find(".textInput").css("textDecoration","underline");e.fontStyles[2]=1}else{a.item.find("label span").css("textDecoration","none");a.item.find(".textInput").css("textDecoration","none");e.fontStyles[2]=0}a.target._updateSettings(a.item)});$("input[id$='field.fontFamily']",h).change(function(){var g=
$(this).val();a.item.css("fontFamily",g);a.item.find(".textInput").css("fontFamily",g);e.fontFamily=g;a.target._updateSettings(a.item)});$("select[id$='field.fontSize']",h).change(function(){var g=$(this).val();a.item.find("label").css("fontSize",g+"px");a.item.find(".textInput").css("fontSize",g+"px");e.fontSize=g;a.target._updateSettings(a.item)});a.target._log("fbSingleLineText._getFieldSettingsLanguageSection executed.");return[a.target._twoColumns(c,d),a.target._oneColumn(f),h]},_getFieldSettingsGeneralSection:function(b,
a){a.target._log("fbSingleLineText._getFieldSettingsGeneralSection executing...");var c=$('<div><input type="checkbox" id="field.required" />&nbsp;Required</div>'),d=$('<div><select id="field.restriction" style="width: 99%"> \t\t\t\t<option value="no">any character</option> \t\t\t\t<option value="alphanumeric">alphanumeric only</option> \t\t\t\t<option value="letterswithbasicpunc">letters or punctuation only</option> \t\t\t\t<option value="lettersonly">letters only</option> \t\t\t</select></div>'),
f=a.target._fieldset({text:"Value"}).append(a.target._twoColumns(c,d));$(".col1",f).css("width","32%").removeClass("labelOnTop");$(".col2",f).css("marginLeft","34%").removeClass("labelOnTop");$("input",c).attr("checked",a.settings.required).change(function(){if($(this).attr("checked")){a.item.find("em").text("*");a.settings.required=true}else{a.item.find("em").text("");a.settings.required=false}a.target._updateSettings(a.item)});$("select option[value='"+a.settings.restriction+"']",d).attr("selected",
"true");$("select",d).change(function(){a.settings.restriction=$(this).val();a.target._log("fb.settings.restriction = "+a.settings.restriction);a.target._updateSettings(a.item)});var e=a.item.find(".textInput"),h=a.settings.styles;if(h.value.color=="default")h.value.color=e.css("color");if(h.value.backgroundColor=="default")h.value.backgroundColor=e.css("backgroundColor");c=a.target._labelValueDescriptionColorPanel(h);$("input[id$='field.label.color']",c).change(function(){var g=$(this).data("colorPicker").color;
a.item.css("color","#"+g);h.label.color=g;a.target._updateSettings(a.item)});$("input[id$='field.label.backgroundColor']",c).change(function(){var g=$(this).data("colorPicker").color;a.item.css("backgroundColor","#"+g);h.label.backgroundColor=g;a.target._updateSettings(a.item)});$("input[id$='field.value.color']",c).change(function(){var g=$(this).data("colorPicker").color;e.css("color","#"+g);h.value.color=g;a.target._updateSettings(a.item)});$("input[id$='field.value.backgroundColor']",c).change(function(){var g=
$(this).data("colorPicker").color;e.css("backgroundColor","#"+g);h.value.backgroundColor=g;a.target._updateSettings(a.item)});$("input[id$='field.description.color']",c).change(function(){var g=$(this).data("colorPicker").color;a.item.find(".formHint").css("color","#"+g);h.description.color=g;a.target._updateSettings(a.item)});$("input[id$='field.description.backgroundColor']",c).change(function(){var g=$(this).data("colorPicker").color;a.item.find(".formHint").css("backgroundColor","#"+g);h.description.backgroundColor=
g;a.target._updateSettings(a.item)});a.target._log("fbSingleLineText._getFieldSettingsGeneralSection executed.");return[f,c]},_languageChange:function(b,a){a.target._log("fbSingleLineText.languageChange executing...");var c=a.settings.styles,d=a.target._getFbLocalizedSettings().styles,f=c.fontFamily!="default"?c.fontFamily:d.fontFamily;d=c.fontSize!="default"?c.fontSize:d.fontSize;var e=c.fontStyles[0]==1?"bold":"normal",h=c.fontStyles[1]==1?"italic":"normal";c=c.fontStyles[2]==1?"underline":"none";
a.item.css("fontFamily",f);a.item.find("label span").text(a.settings.label).css("textDecoration",c);a.item.find("label").css("fontWeight",e).css("fontStyle",h).css("fontSize",d+"px");a.item.find(".textInput").val(a.settings.value).css("fontWeight",e).css("fontStyle",h).css("textDecoration",c).css("fontFamily",f).css("fontSize",d+"px");a.item.find(".formHint").text(a.settings.description);a.target._log("fbSingleLineText.languageChange executed.")}});$.widget("fb.fbSingleLineText",FbSingleLineText);
