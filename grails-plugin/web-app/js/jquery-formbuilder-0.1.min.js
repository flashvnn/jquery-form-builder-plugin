/*
* jquery-form-builder-plugin - JQuery WYSIWYG Web Form Builder
* http://code.google.com/p/jquery-form-builder-plugin/
*
* Revision: 26
* Version: 0.1
* Copyright 2011 Lim Chee Kin (limcheekin@vobject.com)
*
* Licensed under Apache v2.0 http://www.apache.org/licenses/LICENSE-2.0.html
*
* Date: Thu Jan 13 23:36:39 GMT+08:00 2011
*/
var FormBuilder={options:{widgets:["PlainText"],tabSelected:0,_builderForm:"#builderForm fieldset",_emptyBuilderPanel:"#emptyBuilderPanel",_standardFieldsPanel:"#standardFields",_fancyFieldsPanel:"#fancyFields",_fieldSettingsLanguageSection:"#fieldSettings fieldset.language:first",_fieldSettingsGeneralSection:"#fieldSettings div.general:first",_formSettingsLanguageSection:"#formSettings fieldset.language:first",_formSettingsGeneralSection:"#formSettings div.general:first"},_create:function(){this._log("FormBuilder._create called. this.options.widgets = "+
this.options.widgets);this._initBuilderPalette();this._initBuilderPanel()},_initBuilderPalette:function(){$(window).scroll(function(){if($(window).scrollTop()>$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","fixed");$(".floatingPanel").css("top","0")}if($(window).scrollTop()<=$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","relative");$(".floatingPanel").css("top",$(".floatingPanelIdentifier").position)}});
$("#paletteTabs").tabs({selected:this.options.tabSelected});var a=this.options.widgets,d=a.length,c,b,e;for(e=0;e<d;e++){c=$.fb["fb"+a[e]].prototype.options;b=$('<a id="'+c.type+'" href="#" class="fbWidget">'+c.name+"</a>")["fb"+c.type]();b.button().appendTo(c.belongsTo)}},_initBuilderPanel:function(){this._initFormSettings();this._initSortableWidgets();this._initWidgetsEventBinder()},_initFormSettings:function(){var a=$(this.options._builderForm),d=$("#name",a),c=$("#description",a);a=$(this.options._formSettingsGeneralSection);
$("input[id$='form.name']",a).val(d.val()).change(function(b){d.val($(b.target).val())});$("[id$='form.description']",a).val(c.val()).change(function(b){c.val($(b.target).val())})},_initWidgetsEventBinder:function(){var a=$("#builderForm div.ctrlHolder"),d=["name","settings","sequence"];if(a.size()>0){var c,b;$(this.options._emptyBuilderPanel+":visible").hide();a.each(function(e){c=$(this);b=c.find("input[id$='fields["+e+"].type']").val();c.click($.fb["fb"+b].prototype.getFieldSettings);for(var f=
0;f<d.length;f++)c.find("input[id$='fields["+e+"]."+d[f]+"']").change($.fb.fbWidget.prototype._updateStatus)});a.find(".closeButton").click($.fb.fbWidget.prototype._deleteWidget)}},_initSortableWidgets:function(){var a=$(this.options._builderForm);a.sortable({axis:"y",cursor:"move",helper:function(d,c){return $(c).clone().css({opacity:0.6,border:"3px solid #cccccc"})},start:function(d,c){var b=$(c.item).prev();if(b.attr("id")){c.item.prevId=b.attr("id");c.item.originalPositionTop=b.position().top}},
update:function(d,c){var b=$(c.item),e;e=c.position.top>c.item.originalPositionTop;$.fb.formbuilder.prototype._log("moveDown = "+e+", ui.position.top = "+c.position.top+", ui.item.originalPositionTop = "+c.item.originalPositionTop);if(c.item.prevId)if(e){e=b.prevUntil("#"+c.item.prevId);$.fb.formbuilder.prototype._moveDown(b,e)}else{$.fb.formbuilder.prototype._getSequence(b).val($.fb.formbuilder.prototype._getSequence(b.next()).val()).trigger("change");e=b.nextUntil("#"+c.item.prevId);e.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))});
$.fb.formbuilder.prototype._increaseSequence($("#"+c.item.prevId))}else{e=b.prevAll();$.fb.formbuilder.prototype._moveDown(b,e)}}});a.disableSelection()},_init:function(){this._log("FormBuilder._init called.");this.method1("calling from FormBuilder._init")},destroy:function(){this._log("FormBuilder.destroy called.");$.Widget.prototype.destroy.call(this)},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_moveDown:function(a,d){$.fb.formbuilder.prototype._getSequence(a).val($.fb.formbuilder.prototype._getSequence(a.prev()).val()).trigger("change");
d.each(function(){$.fb.formbuilder.prototype._decreaseSequence($(this))})},_getSequence:function(a){return a.find("input[id$='fields["+a.attr("rel")+"].sequence']")},_increaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()*1+1);a.trigger("change")}},_decreaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()-1);a.trigger("change")}},method1:function(a){this._log("FormBuilder.method1 called. params = "+
a)}};$.widget("fb.formbuilder",FormBuilder);
var FbWidget={options:{option1:"FbWidget.optionValue",_styleClass:"ctrlHolder"},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_create:function(){this._log("FbWidget._create called. this.options.option1 = "+this.options.option1);this.element.click(this.createWidget)},_init:function(){this._log("FbWidget._init called.")},destroy:function(){this._log("FbWidget.destroy called.");this.element.button("destroy");$.Widget.prototype.destroy.call(this)},createField:function(a,
d,c,b){var e=$.fb.formbuilder.prototype.options,f=$("#builderForm div.ctrlHolder").size();$('<a class="ui-corner-all closeButton" href="#"><span class="ui-icon ui-icon-close">delete this widget</span></a>').prependTo(d).click($.fb.fbWidget.prototype._deleteWidget);d.attr("rel",f);d.append($.fb.fbWidget.prototype._createFieldProperties(a,c,b,f));$(e._emptyBuilderPanel+":visible").hide();$(e._builderForm).append(d).sortable("refresh")},propertyName:function(a){a=a.replace(/ /gi,"");return a=a.charAt(0).toLowerCase()+
a.substring(1)},_deleteWidget:function(a){var d=$(a.target).parent().parent(),c=d.attr("rel");$("#builderForm div.ctrlHolder").size();d.find("input[id$='fields["+c+"].status']").val("D");d.hide();a.stopPropagation()},_createFieldProperties:function(a,d,c,b){a=$('<div class="fieldProperties"> \t\t<input type="hidden" id="fields['+b+'].name" name="fields['+b+'].name" value="'+a+'" /> \t\t<input type="hidden" id="fields['+b+'].type" name="fields['+b+'].type" value="'+d.type+'" /> \t\t<input type="hidden" id="fields['+
b+'].settings" name="fields['+b+'].settings" /> \t\t<input type="hidden" id="fields['+b+'].sequence" name="fields['+b+'].sequence" value="'+b+'" /> \t\t<input type="hidden" id="fields['+b+'].status" name="fields['+b+'].status" /> \t\t</div>');a.find("input[id$='fields["+b+"].settings']").val($.toJSON(c));return a},_updateStatus:function(a){$widget=$(a.target);$.fb.fbWidget.prototype._log($widget.attr("id")+" updated");$widget.parent().find("input:last").val("U")},createWidget:function(){alert("createWidget(event) should be overriden by subclass")}};
$.widget("fb.fbWidget",FbWidget);
var FbPlainText=$.extend({},$.fb.fbWidget.prototype,{options:{type:"PlainText",name:"Plain Text",html:'<div class="ctrlHolder"><div class="PlainText"></div></div>',belongsTo:$.fb.formbuilder.prototype.options._fancyFieldsPanel,settings:{en:{text:"Plain Text Value",classes:["leftAlign","topAlign"]},zh:{text:"\u7121\u683c\u5f0f\u6587\u5b57",classes:["rightAlign","topAlign"]},styles:{fontFamily:"default",color:"default",backgroundColor:"default"}}},_create:function(){$.fb.fbWidget.prototype._create.call(this);this._log("FbPlainText._create called. this.options.text = "+
this.options.settings.en.text)},_init:function(){$.fb.fbWidget.prototype._init.call(this);this._log("FbPlainText._init called.")},destroy:function(){this._log("FbPlainText.destroy called.");$.fb.fbWidget.prototype.destroy.call(this)},createWidget:function(a){a=$(a.target).parent().data("fbPlainText");var d=$("div."+a.options.type).size()+1,c=a.propertyName(a.options.type+d),b=$("#language").val();d=a.options.settings[b].text+" "+d;var e=$(a.options.html).addClass(a.options.settings[b].classes[1]).attr("id",
c).click(a.getFieldSettings),f=jQuery.extend(true,{},a.options.settings);f[b].text=d;e.find("div.PlainText").text(d).addClass(f[b].classes[0]);a.createField(c,e,a.options,f)},getFieldSettings:function(a){a=$(a.target);var d=a.attr("class").indexOf($.fb.fbWidget.prototype.options._styleClass)>-1?a:a.parent();a=$.fb.formbuilder.prototype.options;var c=d.attr("rel"),b=d.find("input[id$='fields["+c+"].settings']");$.fb.fbWidget.prototype._log("settings = "+b.val());$.fb.fbWidget.prototype._log("unescaped settings = "+
unescape(b.val()));var e=$.parseJSON(unescape(b.val()));$.fb.fbWidget.prototype._log("PlainText.getFieldSettings. id = "+d.attr("id")+", "+d.attr("rel"));var f=$('<div class="clear labelOnTop"> \t\t<label for="text">Text (?)</label><br /> \t\t<input type="text" id="text" /> \t</div> \t<div class="2cols"> \t\t<div class="labelOnTop col1 noPaddingBottom"> \t\t\t<label for="horizontalAlignment">Horizontal Align (?)</label><br /> \t\t\t<select id="horizontalAlignment"> \t\t\t\t<option value="leftAlign">left</option> \t\t\t\t<option value="centerAlign">center</option> \t\t\t\t<option value="rightAlign">right</option> \t\t\t</select> \t\t</div> \t\t<div class="labelOnTop col2"> \t\t<label for="verticalAlignment">Vertical Align (?)</label><br /> \t\t\t<select id="verticalAlignment"> \t\t\t\t<option value="topAlign">top</option> \t\t\t\t<option value="middleAlign">middle</option> \t\t\t\t<option value="bottomAlign">bottom</option> \t\t\t</select> \t  </div> \t</div>'),
i=$(a._fieldSettingsLanguageSection),j=$("#language"),h=j.val();$("legend",i).text("Language: "+j.find("option:selected").text());$.fb.fbWidget.prototype._log("language = "+h+", "+j.find("option:selected").text());f.find("input#text").val(d.find("div.PlainText").text()).change(function(g){g=$(g.target).val();d.find("div.PlainText").text(g);e[h].text=g;b.val($.toJSON(e)).trigger("change")});f.find("select#horizontalAlignment").val(e[h].classes[0]).change(function(g){var k=d.find("div.PlainText");g=
$(g.target).val();k.removeClass(e[h].classes[0]).addClass(g);e[h].classes[0]=g;b.val($.toJSON(e)).trigger("change")});f.find("select#verticalAlignment").val(e[h].classes[1]).change(function(g){d.find("div.PlainText");g=$(g.target).val();d.removeClass(e[h].classes[1]).addClass(g);e[h].classes[1]=g;b.val($.toJSON(e)).trigger("change")});i.children(":not(legend)").remove();i.append(f);f=$('<div class="2cols"> \t\t<div class="labelOnTop col1 noPaddingBottom"> \t\t\t<label for="name">Name (?)</label><br/> \t\t  <input type="text" id="name" /> \t\t</div> \t</div>');
f.find("input#name").val(d.find("input[id$='fields["+c+"].name']").val()).change(function(g){d.find("input[id$='fields["+c+"].name']").val($(g.target).val()).trigger("change")});a=$(a._fieldSettingsGeneralSection);a.children().remove();a.append(f);$("#paletteTabs").tabs("select",1)}});$.widget("fb.fbPlainText",FbPlainText);
