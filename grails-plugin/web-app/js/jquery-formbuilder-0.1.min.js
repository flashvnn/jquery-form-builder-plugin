/*
* jquery-form-builder-plugin - JQuery WYSIWYG Web Form Builder
* http://code.google.com/p/jquery-form-builder-plugin/
*
* Revision: 58
* Version: 0.1
* Copyright 2011 Lim Chee Kin (limcheekin@vobject.com)
*
* Licensed under Apache v2.0 http://www.apache.org/licenses/LICENSE-2.0.html
*
* Date: Fri Jan 21 20:21:57 GMT+08:00 2011 
*/
var FormBuilder={options:{widgets:["PlainText"],tabSelected:0,readOnly:false,tabDisabled:[],formCounter:1,settings:{en:{name:"Form",classes:["leftAlign"],heading:"h2",fontStyles:[1,0,0]},zh:{name:"\u8868\u683c",classes:["rightAlign"],heading:"h2",fontStyles:[1,0,0]},styles:{color:"default",backgroundColor:"default",fontFamily:"default",fontSize:"default"}},_id:"#container",_languages:["en","zh"],_builderPanel:"#builderPanel",_builderForm:"#builderForm fieldset",_emptyBuilderPanel:"#emptyBuilderPanel",
_paletteTabs:"#paletteTabs",_standardFieldsPanel:"#standardFields",_fancyFieldsPanel:"#fancyFields",_fieldSettingsPanel:"#fieldSettings",_fieldSettingsLanguageSection:"#fieldSettings fieldset.language:first",_fieldSettingsGeneralSection:"#fieldSettings div.general:first",_formSettingsLanguageSection:"#formSettings fieldset.language:first",_formSettingsGeneralSection:"#formSettings div.general:first",_languagesSupportIdGeneration:["en"]},_create:function(){this._log("FormBuilder._create called. this.options.widgets = "+
this.options.widgets);this._initBrowserDefaultSettings();this._initBuilderPalette();this._initBuilderPanel()},_initBrowserDefaultSettings:function(){var a=$("html"),b=this.options;b._fontFamily=a.css("fontFamily");b._fontSize=a.css("fontSize");b._color=a.css("color");b._backgroundColor=a.css("backgroundColor");a=b._fontSize.lastIndexOf("px");if(a>-1)b._fontSize=b._fontSize.substring(0,a)},_initBuilderPalette:function(){$(window).scroll(function(){if($(window).scrollTop()>$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position",
"fixed");$(".floatingPanel").css("top","0")}if($(window).scrollTop()<=$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","relative");$(".floatingPanel").css("top",$(".floatingPanelIdentifier").position)}});$(this.options._paletteTabs).tabs({selected:this.options.tabSelected,disabled:this.options.tabDisabled,select:this._isFieldSettingsTabCanOpen});var a=this.options.widgets,b=a.length,c,d,e;for(e=0;e<b;e++){c=$.fb["fb"+a[e]].prototype.options;d=$('<a id="'+
c._type+'" href="#" class="fbWidget">'+c.name+"</a>");d.button()["fb"+c._type]().appendTo(c.belongsTo)}},_isFieldSettingsTabCanOpen:function(a,b){if(b.index==1){var c=$.fb.formbuilder.prototype.options;$(this).tabs("select",0);if($(c._emptyBuilderPanel).is(":visible")){$(c._standardFieldsPanel).qtip({content:"No field was created. Please select standard field or fancy field.",position:{my:"bottom left",at:"top center"},show:{event:false,ready:true,effect:function(){$(this).show("drop",{direction:"up"})}},
hide:{target:$(c._standardFieldsPanel+", "+c._fancyFieldsPanel)},style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}});return false}else if($(c._builderForm+" ."+$.fb.fbWidget.prototype.options._selectedClass).length===0){$("."+$.fb.fbWidget.prototype.options._styleClass+":first").qtip({content:"Please select field below to see it's Field Settings.",position:{my:"bottom center",at:"top center"},show:{event:false,ready:true,effect:function(){$(this).show("drop",{direction:"up"})}},
hide:"click",style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}});return false}}},_initBuilderPanel:function(){this._initFormSettings();if(this.options.readOnly){$("input:not(div.buttons input)").attr("disabled",true);$("select").attr("disabled",true);$("textarea").attr("disabled",true)}else this._initSortableWidgets();this._initWidgetsEventBinder()},_initFormSettings:function(){for(var a=$.fb.fbWidget.prototype,b=$(this.options._builderPanel),c=$(this.options._builderForm),
d=$(this.options._formSettingsLanguageSection),e=$(this.options._formSettingsGeneralSection),h=$("#language",d).change(this._languageChange),f=this.options,g=f.settings[h.val()],i=this,k=$(".formHeading",c),m=0;m<f._languages.length;m++)f.settings[f._languages[m]].name+=" "+f.formCounter;k.append("<"+g.heading+' class="heading">'+g.name+"</"+g.heading+">");$("#name",c).val(a._propertyName(g.name));m=$('<label for="form.name">Name (?)</label><br/> \t\t\t\t  <input type="text" id="form.name" value="'+
g.name+'" />').keyup(function(){var j=$(this).val();if($.inArray(h.val(),f._languagesSupportIdGeneration)>-1){var p=a._propertyName(j);$("#name",c).val(p).change()}a._log("$(this).val() = "+j);g.name=j;$(g.heading,k).text(j)});var n=$('<select> \t\t\t\t\t<option value="h1">Heading 1</option> \t\t\t\t\t<option value="h2">Heading 2</option> \t\t\t\t\t<option value="h3">Heading 3</option> \t\t\t\t\t<option value="h4">Heading 4</option> \t\t\t\t\t<option value="h5">Heading 5</option> \t\t\t\t\t<option value="h6">Heading 6</option> \t\t\t\t</select>').css("marginTop",
"1em").val(g.heading).attr("id","form.heading").change(function(){var j=$(this).val(),p=$(g.heading,k).text();p=$("<"+j+' class="heading">'+p+"</"+j+">");g.fontStyles[0]===0&&p.css("fontWeight","normal");g.fontStyles[1]==1&&p.css("fontStyle","italic");g.fontStyles[2]==1&&p.css("textDecoration","underline");$(g.heading,k).replaceWith(p);g.heading=j;i._updateSettings(i)}),q=a._horizontalAlignment({name:"form.horizontalAlignment",value:g.classes[0]});$("select",q).change(function(){var j=$(this).val();
k.removeClass(g.classes[0]).addClass(j);g.classes[0]=j;i._updateSettings(i)}).change();var r=a._fontStyles({names:["form.bold","form.italic","form.underline"],checked:g.fontStyles});$("input[id$='form.bold']",r).change(function(){if($(this).attr("checked")){$(g.heading,k).css("fontWeight","bold");g.fontStyles[0]=1}else{$(g.heading,k).css("fontWeight","normal");g.fontStyles[0]=0}i._updateSettings(i)}).change();$("input[id$='form.italic']",r).change(function(){if($(this).attr("checked")){$(g.heading,
k).css("fontStyle","italic");g.fontStyles[1]=1}else{$(g.heading,k).css("fontStyle","normal");g.fontStyles[1]=0}i._updateSettings(i)}).change();$("input[id$='form.underline']",r).change(function(){if($(this).attr("checked")){$(g.heading,k).css("textDecoration","underline");g.fontStyles[2]=1}else{$(g.heading,k).css("textDecoration","none");g.fontStyles[2]=0}i._updateSettings(i)}).change();var o=f.settings.styles.fontFamily;if(o=="default")o=f._fontFamily;o=a._fontPicker({name:"form.fontFamily",value:o});
$("input[id$='form.fontFamily']",o).change(function(){var j=$(this).val();b.css("fontFamily",j);f.settings.styles.fontFamily=j;i._updateSettings(i)}).change();var l=f.settings.styles.fontSize;if(l=="default")l=f._fontSize;l=a._fontSize({label:"Size",name:"form.fontSize",value:l});$("select[id$='form.fontSize']",l).change(function(){var j=$(this).val();b.css("fontSize",j+"px");f.settings.styles.fontSize=j;i._updateSettings(i)}).change();o=a._twoColumns(o,l);o.find(".col2").addClass("noPaddingBottom").css("marginLeft",
"60%");l=f.settings.styles.color;if(l=="default")l=f._color;var s=f.settings.styles.backgroundColor;if(s=="default")s=f._backgroundColor;l=a._colorPanel({color:l,backgroundColor:s,idPrefix:"form."});$("input[id$='form.color']",l).change(function(){var j=$(this).attr("title");b.css("color","#"+j);f.settings.styles.color=j;i._updateSettings(i)}).change();$("input[id$='form.backgroundColor']",l).change(function(){var j=$(this).attr("title");b.css("backgroundColor","#"+j);f.settings.styles.backgroundColor=
j;i._updateSettings(i)}).change();d.append(a._oneColumn(m)).append(a._twoRowsOneRowLayout(n,q,r));e.append(a._fieldset({text:"Fonts"}).append(o)).append(l)},_languageChange:function(){$.fb.formbuilder.prototype._log("languageChange("+$(this).val()+", "+$("option:selected",this).text()+")");var a=$.fb.fbWidget.prototype._getFbOptions(),b=$("."+$.fb.fbWidget.prototype.options._styleClass+":visible"),c=$(this).val(),d=$("option:selected",this).text(),e=a.settings[c],h=$(".formHeading"),f=$(a._formSettingsLanguageSection),
g,i,k;$("input[id$='form.name']",f).val(e.name);$("select[id$='form.heading'] option[value='"+e.heading+"']",f).attr("selected","true");var m=$("<"+e.heading+' class="heading">'+e.name+"</"+e.heading+">").css("fontWeight",e.fontStyles[0]==1?"bold":"normal").css("fontStyle",e.fontStyles[1]==1?"italic":"normal").css("textDecoration",e.fontStyles[2]==1?"underline":"none");$(".heading",h).replaceWith(m);$.fb.formbuilder.prototype._log("formSettings.fontStyles[2] = "+e.fontStyles[2]);$("input[id$='form.bold']",
f).attr("checked",e.fontStyles[0]);$("input[id$='form.italic']",f).attr("checked",e.fontStyles[1]);$("input[id$='form.underline']",f).attr("checked",e.fontStyles[2]);h.removeClass("leftAlign centerAlign rightAlign").addClass(e.classes[0]);$("select[id$='form.horizontalAlignment'] option[value='"+e.classes[0]+"']",f).attr("selected","true");b.each(function(){var n=$(this);(k=n.attr("class").indexOf($.fb.fbWidget.prototype.options._selectedClass)>-1)&&$(a._fieldSettingsLanguageSection+" legend").text("Language: "+
d);g=n.data("fbWidget");i=n.find("input[id$='fields["+n.attr("rel")+"].type']").val();$.fb.formbuilder.prototype._log("type = "+i);$this=$("#"+i).data("fb"+i);$this._languageChange(n,g[c],k)})},_updateSettings:function(a){a._log("_updateSettings = "+$.toJSON(a.options.settings));$("#settings").val($.toJSON(a.options.settings)).change()},_initWidgetsEventBinder:function(){var a=$("."+$.fb.fbWidget.prototype.options._styleClass);if(a.size()>0){var b,c,d=["name","settings","sequence"];$(this.options._emptyBuilderPanel+
":visible").hide();a.each(function(e){b=$(this);c=b.find("input[id$='fields["+e+"].type']").val();b.click($.fb["fb"+c].prototype._createFieldSettings);for(var h=0;h<d.length;h++)b.find("input[id$='fields["+e+"]."+d[h]+"']").change($.fb.fbWidget.prototype._updateStatus)});this.options.readOnly||a.find(".closeButton").click($.fb.fbWidget.prototype._deleteWidget)}},_initSortableWidgets:function(){var a=$(this.options._builderForm);a.sortable({axis:"y",cursor:"move",helper:function(b,c){return $(c).clone().css({opacity:0.6,
border:"3px solid #cccccc"})},start:function(b,c){var d=$(c.item).prev();if(d.attr("rel")){c.item.prevIndex=d.attr("rel");c.item.originalPositionTop=d.position().top}},update:function(b,c){var d=$(c.item),e;e=c.position.top>c.item.originalPositionTop;$.fb.formbuilder.prototype._log("moveDown = "+e+", ui.position.top = "+c.position.top+", ui.item.originalPositionTop = "+c.item.originalPositionTop);if(c.item.prevIndex){var h='[rel="'+c.item.prevIndex+'"]';if(e){e=d.prevUntil(h);$.fb.formbuilder.prototype._moveDown(d,
e)}else{$.fb.formbuilder.prototype._getSequence(d).val($.fb.formbuilder.prototype._getSequence(d.next()).val()).change();e=d.nextUntil(h);e.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))});$.fb.formbuilder.prototype._increaseSequence($(h))}}else{e=d.prevAll();$.fb.formbuilder.prototype._moveDown(d,e)}}});a.disableSelection()},_init:function(){this._log("FormBuilder._init called.");this.method1("calling from FormBuilder._init")},destroy:function(){this._log("FormBuilder.destroy called.");
$.Widget.prototype.destroy.call(this)},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_moveDown:function(a,b){$.fb.formbuilder.prototype._getSequence(a).val($.fb.formbuilder.prototype._getSequence(a.prev()).val()).change();b.each(function(){$.fb.formbuilder.prototype._decreaseSequence($(this))})},_getSequence:function(a){return a.find("input[id$='fields["+a.attr("rel")+"].sequence']")},_increaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);
a.val(a.val()*1+1);a.change()}},_decreaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()-1);a.change()}},method1:function(a){this._log("FormBuilder.method1 called. params = "+a)}};$.widget("fb.formbuilder",FormBuilder);
var ColorPicker={options:{name:"jquery-color-picker",value:"",ico:"ico.gif",title:"Pick a colour",inputBG:true,showColorCode:false,speed:500,openTxt:"Open colour picker",type:"basic",width:180,basicColors:["ffffff","ffccc9","ffce93","fffc9e","ffffc7","9aff99","96fffb","cdffff","cbcefb","cfcfcf","fd6864","fe996b","fffe65","fcff2f","67fd9a","38fff8","68fdff","9698ed","c0c0c0","fe0000","f8a102","ffcc67","f8ff00","34ff34","68cbd0","34cdf9","6665cd","9b9b9b","cb0000","f56b00","ffcb2f","ffc702","32cb00",
"00d2cb","3166ff","6434fc","656565","9a0000","ce6301","cd9934","999903","009901","329a9d","3531ff","6200c9","343434","680100","963400","986536","646809","036400","34696d","00009b","303498","000000","330001","643403","663234","343300","013300","003532","010066","340096"],webSafeColors:["000000","000033","000066","000099","0000CC","0000FF","003300","003333","003366","003399","0033CC","0033FF","006600","006633","006666","006699","0066CC","0066FF","009900","009933","009966","009999","0099CC","0099FF",
"00CC00","00CC33","00CC66","00CC99","00CCCC","00CCFF","00FF00","00FF33","00FF66","00FF99","00FFCC","00FFFF","330000","330033","330066","330099","3300CC","3300FF","333300","333333","333366","333399","3333CC","3333FF","336600","336633","336666","336699","3366CC","3366FF","339900","339933","339966","339999","3399CC","3399FF","33CC00","33CC33","33CC66","33CC99","33CCCC","33CCFF","33FF00","33FF33","33FF66","33FF99","33FFCC","33FFFF","660000","660033","660066","660099","6600CC","6600FF","663300","663333",
"663366","663399","6633CC","6633FF","666600","666633","666666","666699","6666CC","6666FF","669900","669933","669966","669999","6699CC","6699FF","66CC00","66CC33","66CC66","66CC99","66CCCC","66CCFF","66FF00","66FF33","66FF66","66FF99","66FFCC","66FFFF","990000","990033","990066","990099","9900CC","9900FF","993300","993333","993366","993399","9933CC","9933FF","996600","996633","996666","996699","9966CC","9966FF","999900","999933","999966","999999","9999CC","9999FF","99CC00","99CC33","99CC66","99CC99",
"99CCCC","99CCFF","99FF00","99FF33","99FF66","99FF99","99FFCC","99FFFF","CC0000","CC0033","CC0066","CC0099","CC00CC","CC00FF","CC3300","CC3333","CC3366","CC3399","CC33CC","CC33FF","CC6600","CC6633","CC6666","CC6699","CC66CC","CC66FF","CC9900","CC9933","CC9966","CC9999","CC99CC","CC99FF","CCCC00","CCCC33","CCCC66","CCCC99","CCCCCC","CCCCFF","CCFF00","CCFF33","CCFF66","CCFF99","CCFFCC","CCFFFF","FF0000","FF0033","FF0066","FF0099","FF00CC","FF00FF","FF3300","FF3333","FF3366","FF3399","FF33CC","FF33FF",
"FF6600","FF6633","FF6666","FF6699","FF66CC","FF66FF","FF9900","FF9933","FF9966","FF9999","FF99CC","FF99FF","FFCC00","FFCC33","FFCC66","FFCC99","FFCCCC","FFCCFF","FFFF00","FFFF33","FFFF66","FFFF99","FFFFCC","FFFFFF"],customColors:[]},_init:function(){this._log("ColorPicker._init called.");this.element.append('<input type="text" id="'+this.options.name+'" name="'+this.options.name+'" /> \t\t\t\t<a href="#" rel="'+this.options.name+'"><img border="0" src="'+this.options.ico+'" alt="'+this.options.openTxt+
'"/></a>');var a=$("input",this.element).attr("readonly",true),b=this.element.data("colorPicker"),c="colorpicker_"+this.options.type;b.options.showColorCode?a.val(this.options.value):a.attr("title",this.options.value).attr("disabled","true");var d=$("#"+c);if(d.length==0){for(var e="",h=this.options[this.options.type+"Colors"],f,g=0;g<h.length;g++){f=h[g];if(f!="")e+='<li><a href="#" title="'+f+'" rel="'+f+'" style="background: #'+f+"; color: "+this._hexInvert(f)+';">'+f+"</a></li>"}d=$('<div id="'+
c+'" class="colorPicker">'+(this.options.title?"<h2>"+this.options.title+"</h2>":"")+"<ul>"+e+"</ul></div>").appendTo(document.body).hide();$(document.body).click(function(k){$(k.target).is(".colorPicker")||$(k.target).parents(".colorPicker").length||d.hide(b.options.speed)})}var i=$("a",this.element);if(this.options.inputBG){c=b.options.showColorCode?a.val():a.attr("title");if(c.length==6)c="#"+c;a.css({background:c,color:"#"+this._hexInvert(c)})}i.click(function(){var k=i.offset();d.css({position:"absolute",
left:k.left+"px",top:k.top+"px",width:b.options.width+"px"}).show(b.options.speed).attr("rel",i.attr("rel"));return false});$("a",d).click(function(k){var m=$("input[id$='"+d.attr("rel")+"']"),n=$(this).attr("rel"),q=m.parent().data("colorPicker").options;q.showColorCode?m.val(n):m.attr("title",n);q.inputBG&&m.css({background:"#"+n,color:"#"+b._hexInvert(n)});m.change();d.hide(b.options.speed);k.stopImmediatePropagation();return false})},_log:function(a){window.console&&window.console.log&&window.console.log(a)},
_hexInvert:function(a){var b=a.substr(0,2),c=a.substr(2,2);a=a.substr(4,2);return 0.212671*b+0.71516*c+0.072169*a<0.5?"ffffff":"000000"}};$.widget("fb.colorPicker",ColorPicker);
var FontPicker={fonts:Array("Arial,Arial,Helvetica,sans-serif","Arial Black,Arial Black,Gadget,sans-serif","Comic Sans MS,Comic Sans MS,cursive","Courier New,Courier New,Courier,monospace","Georgia,Georgia,serif","Impact,Charcoal,sans-serif","Lucida Console,Monaco,monospace","Lucida Sans Unicode,Lucida Grande,sans-serif","Palatino Linotype,Book Antiqua,Palatino,serif","Tahoma,Geneva,sans-serif","Times New Roman,Times,serif","Trebuchet MS,Helvetica,sans-serif","Verdana,Geneva,sans-serif"),options:{defaultFont:"Tahoma",
id:"fontbox",name:"fontPickerInput",selClass:"fontPicker",fontclass:"singlefont",speed:100,hoverColor:"#efefff",bgColor:"#ffffee"},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_init:function(){var a=this.options,b=$("#"+a.id);this.element.parent().append('<input type="hidden" id="'+a.name+'" value="'+a.defaultFont+'" />');if(!b.length){b=$('<div id="'+a.id+'" ></div>').appendTo(document.body).hide();$(document.body).click(function(c){$(c.target).is("."+a.selClass)||
$(c.target).is("#"+a.id)||b.slideUp(a.speed)})}this.element.click(function(){if(b.is(":hidden")){var c=$(this);b.css({position:"absolute",left:c.offset().left+"px",top:c.offset().top+c.height()+3+"px"}).attr("rel",c.attr("rel"));b.slideDown(a.speed)}else b.slideUp(a.speed)});if(a.defaultFont.length){this.element.css("fontFamily",a.defaultFont);this.element.text(a.defaultFont)}$.each(this.fonts,function(c,d){b.append('<div class="singlefont" onmouseover="this.style.backgroundColor=\''+a.hoverColor+
"'\" onmouseout=\"this.style.backgroundColor='"+a.bgColor+'\'" style="font-family: '+d+';" value="'+d+'"> '+d.split(",")[0]+"</div>")});$("."+a.fontclass).click(function(c){var d=$(this),e=$("input[id$='"+d.parent().attr("rel")+"']"),h=d.attr("value");e.prev().text(d.text()).css("fontFamily",h);e.val(h).change();b.slideUp(a.speed);c.stopImmediatePropagation()})}};$.widget("fb.fontPicker",FontPicker);
var FbWidget={options:{_styleClass:"ctrlHolder",_selectedClass:"ctrlHolderSelected"},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_create:function(){this._log("FbWidget._create called.")},_init:function(){this._log("FbWidget._init called.");this.element.click(this._createFbWidget)},destroy:function(){this._log("FbWidget.destroy called.");this.element.button("destroy");$.Widget.prototype.destroy.call(this)},_getFbOptions:function(){return $($.fb.formbuilder.prototype.options._id).formbuilder("option")},
_createField:function(a,b,c,d){var e=$.fb.formbuilder.prototype.options,h=$("#builderForm div.ctrlHolder").size();$('<a class="ui-corner-all closeButton" href="#"><span class="ui-icon ui-icon-close">delete this widget</span></a>').prependTo(b).click($.fb.fbWidget.prototype._deleteWidget).hover(function(){$("span",this).removeClass("ui-icon-close").addClass("ui-icon-circle-close")},function(){$("span",this).removeClass("ui-icon-circle-close").addClass("ui-icon-close")});b.attr("rel",h);b.append($.fb.fbWidget.prototype._createFieldProperties(a,
c,d,h));$(e._emptyBuilderPanel+":visible").hide();$(e._builderForm).append(b).sortable("refresh")},_propertyName:function(a){a=a.replace(/ /gi,"");return a=a.charAt(0).toLowerCase()+a.substring(1)},_deleteWidget:function(a){var b=$(a.target).parent().parent(),c=b.attr("rel"),d=$.fb.fbWidget.prototype.options,e=$.fb.formbuilder.prototype.options;if(b.find("input[id$='fields["+c+"].id']").val()=="null")b.remove();else{b.find("input[id$='fields["+c+"].status']").val("D");b.toggle("slide",{direction:"up"},
"fast")}c=$("."+d._styleClass+":visible");$.fb.fbWidget.prototype._log("_deleteWidget(). $ctrlHolders.size() = "+c.size());b.attr("class").indexOf(d._selectedClass)>-1&&$(e._paletteTabs).tabs("select",0);c.size()===0&&$(e._emptyBuilderPanel).show();a.stopPropagation()},_createFieldProperties:function(a,b,c,d){var e="fields["+d+"].";a=$('<div class="fieldProperties"> \t\t<input type="hidden" id="'+e+'id" name="'+e+'id" value="null" /> \t\t<input type="hidden" id="'+e+'name" name="'+e+'name" value="'+
a+'" /> \t\t<input type="hidden" id="'+e+'type" name="'+e+'type" value="'+b._type+'" /> \t\t<input type="hidden" id="'+e+'settings" name="'+e+'settings" /> \t\t<input type="hidden" id="'+e+'sequence" name="'+e+'sequence" value="'+d+'" /> \t\t<input type="hidden" id="'+e+'status" name="'+e+'status" /> \t\t</div>');a.find("input[id$='"+e+"settings']").val($.toJSON(c));return a},_updateStatus:function(a){$widget=$(a.target);$.fb.fbWidget.prototype._log($widget.attr("id")+" updated");if($widget.parent().find("input:first").val()!=
"null"){$.fb.fbWidget.prototype._log("field status updated");$widget.parent().find("input:last").val("U")}},_createFbWidget:function(){$.fb.fbWidget.prototype._log("_createFbWidget executing");var a="fb"+$(this).fbWidget("option","_type");$.fb.fbWidget.prototype._log("type = "+a);a=$(this).data(a);for(var b=jQuery.extend(true,{},a.options.settings),c=a._getCounter(a),d=a.options._languages,e=0;e<d.length;e++){b[d[e]][a.options._counterField]+=" "+c;a._log(b[d[e]][a.options._counterField])}d=$('<div class="'+
a.options._styleClass+'"></div>').hide();d.data("fbWidget",b);a._log("b4. text = "+b[$("#language").val()].text);e=a._getWidget(a,b[$("#language").val()],d);a._log("at. text = "+b[$("#language").val()].text);c=a._propertyName(a.options._type+c);e.click(a._createFieldSettings);d.append(e).toggle("slide",{direction:"down"},"slow");a._createField(c,d,a.options,b);a._log("_createFbWidget executed")},_createFieldSettings:function(){$.fb.fbWidget.prototype._log("_createFieldSettings executing.");var a=
$(this),b=$.fb.fbWidget.prototype.options._selectedClass;a=a.attr("class").indexOf($.fb.fbWidget.prototype.options._styleClass)>-1?a:a.parent();a.parent().find("."+b).removeClass(b);a.addClass(b);b=a.find("input[id$='fields["+a.attr("rel")+"].type']").val();$.fb.fbWidget.prototype._log("type = "+b);b=$("#"+b).data("fb"+b);var c=b._getFbOptions();b._log("$widget.text() = "+a.text()+", fbOptions.readOnly = "+c.readOnly);if(!a.data("fbWidget")){var d=a.find("input[id$='fields["+a.attr("rel")+"].settings']");
b._log("_createFieldSettings. unescaped settings = "+unescape(d.val()));a.data("fbWidget",$.parseJSON(unescape(d.val())))}d=a.data("fbWidget");var e=$(c._fieldSettingsLanguageSection),h=$("#language");$("legend",e).text("Language: "+h.find("option:selected").text());h=b._getFieldSettingsLanguageSection(b,a,d[h.val()]);e.children(":not(legend)").remove();for(var f=0;f<h.length;f++)e.append(h[f]);h=b._getFieldSettingsGeneralSection(b,a,d);b._log("fieldSettings.length = "+h.length);a=$(c._fieldSettingsGeneralSection);
a.children().remove();for(f=0;f<h.length;f++){b._log(h[f].html());a.append(h[f])}if(c.readOnly){var g=$(c._fieldSettingsPanel);$("input",g).attr("disabled",true);$("select",g).attr("disabled",true);$("textarea",g).attr("disabled",true)}$(c._paletteTabs).tabs("select",1);$("input:first",g).focus();$.fb.fbWidget.prototype._log("_createFieldSettings executed.")},_getCounter:function(a){var b=$("."+a.options._styleClass+":visible"),c=1;if(b.size()>0){var d,e,h,f=0,g=a._propertyName(a.options._type);b.each(function(){d=
$(this);e=d.attr("rel");h=d.find("input[id$='fields["+e+"].name']").val();if(h.indexOf(g)>-1){f=h.substring(g.length)*1;a._log("widgetCounter = "+f);if(f>c)c=f}});f>0&&c++}a._log("counter = "+c);return c},_updateSettings:function(a){var b=a.data("fbWidget");this._log("_updateSettings: \n"+$.toJSON(b));a.find("input[id$='fields["+a.attr("rel")+"].settings']").val($.toJSON(b)).change()},_twoColumns:function(a,b){var c=$('<div class="2cols"> \t\t<div class="labelOnTop col1 noPaddingBottom"></div> \t  <div class="labelOnTop col2"></div>     </div>');
c.find(".col1").append(a);c.find(".col2").append(b);return c},_oneColumn:function(a){return $('<div class="clear labelOnTop"></div>').append(a)},_horizontalAlignment:function(a){a=$.extend({},a);a.label=a.label?a.label:"Horizontal Align";var b=$('<div>  \t\t<label for="'+a.name+'">'+a.label+' (?)</label><br /> \t\t<select> \t\t\t<option value="leftAlign">left</option> \t\t\t<option value="centerAlign">center</option> \t\t\t<option value="rightAlign">right</option> \t\t</select></div>');$("select",
b).val(a.value).attr("id",a.name);return b},_verticalAlignment:function(a){a=$.extend({},a);a.label=a.label?a.label:"Vertical Align";var b=$('<div>  \t\t\t<label for="'+a.name+'">'+a.label+' (?)</label><br /> \t\t\t<select> \t\t\t\t<option value="topAlign">top</option> \t\t\t\t<option value="middleAlign">middle</option> \t\t\t\t<option value="bottomAlign">bottom</option> \t\t\t</select></div>');$("select",b).val(a.value).attr("id",a.name);return b},_name:function(a){var b=a.attr("rel"),c=$('<label for="field.name">Name (?)</label><br/>  \t\t\t\t  <input type="text" id="field.name" />');
$("input[id$='field.name']",c).val(a.find("input[id$='fields["+b+"].name']").val()).keyup(function(d){a.find("input[id$='fields["+b+"].name']").val($(d.target).val()).change()});return c},_colorPicker:function(a){var b=$("<div></div>");!a.type||a.type=="basic"?b.colorPicker({name:a.name,value:a.value,ico:"../images/jquery.colourPicker.gif",title:"Basic Colors"}):b.colorPicker({name:name,value:value,ico:"../images/jquery.colourPicker.gif",title:"Web Safe Colors",type:"webSafe",width:360});b.prepend('<label for="'+
a.name+'">'+a.label+" (?)</label><br/>");return b},_fontPicker:function(a){a=$.extend({},a);this._log("fontPicker("+$.toJSON(a)+")");a.value=a.value.replace(/'/gi,"");a.value=a.value.split(",",1)[0];a.value=a.value!="default"?a.value:this._getFbOptions().settings.styles.fontFamily;var b=$('<div><label for="'+a.name+'">Font (?)</label><br/> \t\t\t\t<div class="fontPicker" rel="'+a.name+'"></div></div>');$(".fontPicker",b).fontPicker({name:a.name,defaultFont:a.value});return b},_fontSize:function(a){this._log("fontSize("+
$.toJSON(a)+")");var b=$('<div> \t \t\t<label for="'+a.name+'">'+a.label+' (?)</label>&nbsp; \t\t  <select> \t\t    <option value="9">9</option> \t\t    <option value="10">10</option> \t\t    <option value="11">11</option> \t\t    <option value="12">12</option> \t\t    <option value="13">13</option> \t\t    <option value="14">14</option> \t\t    <option value="15">15</option> \t\t    <option value="16">16</option> \t\t    <option value="17">17</option> \t\t    <option value="18">18</option> \t\t    <option value="20">20</option> \t\t    <option value="22">22</option> \t\t    <option value="24">24</option> \t\t    <option value="28">28</option> \t\t    <option value="32">32</option> \t\t  </select></div>'),
c=$("select",b);a.value=="default"?c.val(this._getFbOptions().settings.styles.fontSize):c.val(a.value);c.attr("id",a.name);return b},_fontStyles:function(a){var b=a.names;a=a.checked;var c=$('<div> \t\t  <span class="floatClearLeft"><input type="checkbox" id="'+b[0]+'" />&nbsp;Bold</span><br/> \t    <span class="floatClearLeft"><input type="checkbox" id="'+b[1]+'" />&nbsp;Italic</span><br/> \t    <span class="floatClearLeft"><input type="checkbox" id="'+b[2]+'" />&nbsp;Underline</span> \t  </div>');
if(a)for(var d=0;d<a.length;d++)$("input[id$='"+b[d]+"']",c).attr("checked",a[d]);return c},_twoRowsOneRowLayout:function(a,b,c){var d=$('<div class="twoRowsOneRow"> \t\t\t    <div class="row1col1"> \t\t\t      <div class="row2col1"> \t\t\t      </div> \t\t\t    </div> \t\t\t    <div class="row1col2"> \t\t\t    </div> \t\t\t  </div>');$(".row1col1",d).prepend(a);$(".row2col1",d).append(b);$(".row1col2",d).append(c);return d},_fieldset:function(a){return $("<fieldset><legend>"+a.text+"</legend></fieldset>")},
_fontPanel:function(a){var b=a.idPrefix?a.idPrefix:"",c=[b+"bold",b+"italic",b+"underline"];return this._fieldset({text:"Fonts"}).append(this._twoRowsOneRowLayout(this._fontPicker({name:b+"fontFamily",value:a.fontFamily}),this._fontSize({label:"Size",name:b+"fontSize",value:a.fontSize}),this._fontStyles({names:c,checked:a.fontStyles})))},_colorPanel:function(a){a=$.extend({},a);a.idPrefix=a.idPrefix?a.idPrefix:"";if(a.color=="default")a.color=this._getFbOptions().settings.styles.color;if(a.backgroundColor==
"default")a.backgroundColor=this._getFbOptions().settings.styles.backgroundColor;a=this._fieldset({text:"Colors"}).append(this._twoColumns(this._colorPicker({label:"Text",name:a.idPrefix+"color",value:a.color}),this._colorPicker({label:"Background",name:a.idPrefix+"backgroundColor",value:a.backgroundColor})));a.find(".2cols .col2").addClass("noPaddingBottom");return a},_getWidget:function(){$.fb.fbWidget.prototype._log("getWidget($this, settings, ctrlHolder) should be overriden by subclass.")},_getFieldSettingsLanguageSection:function(){$.fb.fbWidget.prototype._log("getFieldSettingsLanguageSection($this, $widget, settings) should be overriden by subclass.")},
_getFieldSettingsGeneralSection:function(){$.fb.fbWidget.prototype._log("getFieldSettingsLanguageSection($this, $widget, settings) should be overriden by subclass.")},_languageChange:function(){$.fb.fbWidget.prototype._log("_languageChange($widget, settings, selected) should be overriden by subclass.")}};$.widget("fb.fbWidget",FbWidget);
var FbPlainText=$.extend({},$.fb.fbWidget.prototype,{options:{name:"Plain Text",belongsTo:$.fb.formbuilder.prototype.options._fancyFieldsPanel,_type:"PlainText",_html:'<div class="PlainText"></div>',_counterField:"text",_languages:["en","zh"],settings:{en:{text:"Plain Text Value",classes:["leftAlign","topAlign"]},zh:{text:"\u7121\u683c\u5f0f\u6587\u5b57",classes:["rightAlign","topAlign"]},styles:{fontFamily:"default",fontSize:"default",fontStyles:[0,0,0],color:"default",backgroundColor:"default"}}},
_init:function(){$.fb.fbWidget.prototype._init.call(this);this.options=$.extend({},$.fb.fbWidget.prototype.options,this.options);this._log("FbPlainText._create called. this.options.text = "+this.options.settings.en.text);this._log("FbPlainText._init called.")},_getWidget:function(a,b,c){c.addClass(b.classes[1]);return $(a.options._html).text(b.text).addClass(b.classes[0])},_getFieldSettingsLanguageSection:function(a,b,c){var d=$('<label for="field.text">Text (?)</label><br />      <input type="text" id="field.text" />').val(b.find("div.PlainText").text()).keyup(function(){var f=
$(this).val();b.find("div.PlainText").text(f);c.text=f;a._updateSettings(b)}),e=a._verticalAlignment({name:"field.verticalAlignment",value:c.classes[1]}).change(function(){var f=$("option:selected",this).val();a._log("field.verticalAlignment value = "+f);b.removeClass(c.classes[1]).addClass(f);c.classes[1]=f;a._updateSettings(b)}),h=a._horizontalAlignment({name:"field.horizontalAlignment",value:c.classes[0]}).change(function(){var f=b.find("div.PlainText"),g=$("option:selected",this).val();f.removeClass(c.classes[0]).addClass(g);
c.classes[0]=g;a._updateSettings(b)});return[a._oneColumn(d),a._twoColumns(h,e)]},_getFieldSettingsGeneralSection:function(a,b,c){var d=c.styles,e=a._getFbOptions().settings.styles;c=d.color!="default"?d.color:e.color;var h=d.backgroundColor!="default"?d.backgroundColor:e.backgroundColor;e=a._fontPanel({fontFamily:d.fontFamily!="default"?d.fontFamily:e.fontFamily,fontSize:d.fontSize!="default"?d.fontSize:e.fontSize,fontStyles:d.fontStyles,idPrefix:"field."});c=a._colorPanel({color:c,backgroundColor:h,
idPrefix:"field."});$("input[id$='field.bold']",e).change(function(){if($(this).attr("checked")){b.css("fontWeight","bold");d.fontStyles[0]=1}else{b.css("fontWeight","normal");d.fontStyles[0]=0}a._updateSettings(b)});$("input[id$='field.italic']",e).change(function(){if($(this).attr("checked")){b.css("fontStyle","italic");d.fontStyles[1]=1}else{b.css("fontStyle","normal");d.fontStyles[1]=0}a._updateSettings(b)});$("input[id$='field.underline']",e).change(function(){if($(this).attr("checked")){b.css("textDecoration",
"underline");d.fontStyles[2]=1}else{b.css("textDecoration","none");d.fontStyles[2]=0}a._updateSettings(b)});$("input[id$='field.fontFamily']",e).change(function(){var f=$(this).val();b.css("fontFamily",f);d.fontFamily=f;a._updateSettings(b)});$("select[id$='field.fontSize']",e).change(function(){var f=$(this).val();b.css("fontSize",f+"px");d.fontSize=f;a._updateSettings(b)});$("input[id$='field.color']",c).change(function(){var f=$(this).attr("title");b.css("color","#"+f);d.color=f;a._updateSettings(b)});
$("input[id$='field.backgroundColor']",c).change(function(){var f=$(this).attr("title");b.css("backgroundColor","#"+f);d.backgroundColor=f;a._updateSettings(b)});return[e,c]},_languageChange:function(a,b,c){this._log("languageChange = "+$.toJSON(b));a.find("div.PlainText").text(b.text).removeClass("leftAlign centerAlign rightAlign").addClass(b.classes[0]);a.removeClass("topAlign middleAlign bottomAlign").addClass(b.classes[1]);if(c){a=$(this._getFbOptions()._fieldSettingsLanguageSection);$("input[id$='field.text']",
a).val(b.text);$("select[id$='field.horizontalAlignment'] option[value='"+b.classes[0]+"']",a).attr("selected","true");$("select[id$='field.verticalAlignment'] option[value='"+b.classes[1]+"']",a).attr("selected","true")}}});$.widget("fb.fbPlainText",FbPlainText);
