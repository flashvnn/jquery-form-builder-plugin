/*
* jquery-form-builder-plugin - JQuery WYSIWYG Web Form Builder
* http://code.google.com/p/jquery-form-builder-plugin/
*
* Revision: 21
* Version: 0.1
* Copyright 2011 Lim Chee Kin (limcheekin@vobject.com)
*
* Licensed under Apache v2.0 http://www.apache.org/licenses/LICENSE-2.0.html
*
* Date: Tue Jan 11 18:12:01 GMT+08:00 2011
*/
var FormBuilder={options:{widgets:["PlainText"],_builderForm:"#builderForm fieldset",_emptyBuilderPanel:"#emptyBuilderPanel",_standardFieldsPanel:"#standardFields",_fancyFieldsPanel:"#fancyFields",_fieldSettingsLanguageSection:"#fieldSettings fieldset.language:first",_fieldSettingsGeneralSection:"#fieldSettings div.general:first"},_create:function(){this._initBuilderPalette();this._initBuilderPanel()},_initBuilderPalette:function(){$(window).scroll(function(){if($(window).scrollTop()>$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position",
"fixed");$(".floatingPanel").css("top","0")}if($(window).scrollTop()<=$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","relative");$(".floatingPanel").css("top",$(".floatingPanelIdentifier").position)}});$("#paletteTabs").tabs();var a=this.options.widgets,e=a.length,d,b,c;for(c=0;c<e;c++){d=$.fb["fb"+a[c]].prototype.options;b=$('<a id="'+d.type+'" href="#" class="fbWidget">'+d.name+"</a>")["fb"+d.type]();b.button().appendTo(d.belongsTo)}},_initBuilderPanel:function(){this._initSortableWidgets();
this._initWidgetsEventBinder()},_initWidgetsEventBinder:function(){for(var a=$("#builderForm div.ctrlHolder"),e=a.size(),d=["name","settings","sequence"],b=0;b<e;b++)for(var c=0;c<d.length;c++)a.find("input[id$='fields["+b+"]."+d[c]+"']").change($.fb.fbWidget.prototype._updateStatus)},_initSortableWidgets:function(){var a=$(this.options._builderForm);a.sortable({axis:"y",cursor:"move",helper:function(e,d){return $(d).clone().css({opacity:0.6,border:"3px solid #cccccc"})},start:function(e,d){var b=
$(d.item).prev();if(b.attr("id")){d.item.prevId=b.attr("id");d.item.originalPositionTop=b.position().top}},update:function(e,d){var b=$(d.item),c;c=d.position.top>d.item.originalPositionTop;if(d.item.prevId)if(c){c=b.prevUntil("#"+d.item.prevId);$.fb.formbuilder.prototype._moveDown(b,c)}else{$.fb.formbuilder.prototype._getSequence(b).val($.fb.formbuilder.prototype._getSequence(b.next()).val()).trigger("change");c=b.nextUntil("#"+d.item.prevId);c.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))});
$.fb.formbuilder.prototype._increaseSequence($("#"+d.item.prevId))}else{c=b.prevAll();$.fb.formbuilder.prototype._moveDown(b,c)}}});a.disableSelection()},_init:function(){this.method1("calling from FormBuilder._init")},destroy:function(){$.Widget.prototype.destroy.call(this)},_moveDown:function(a,e){$.fb.formbuilder.prototype._getSequence(a).val($.fb.formbuilder.prototype._getSequence(a.prev()).val()).trigger("change");e.each(function(){$.fb.formbuilder.prototype._decreaseSequence($(this))})},_getSequence:function(a){return a.find("input[id$='fields["+
a.attr("rel")+"].sequence']")},_increaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()*1+1);a.trigger("change")}},_decreaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()-1);a.trigger("change")}},method1:function(){}};$.widget("fb.formbuilder",FormBuilder);
var FbWidget={options:{option1:"FbWidget.optionValue"},_create:function(){this.element.click(this.createWidget)},_init:function(){},destroy:function(){this.element.button("destroy");$.Widget.prototype.destroy.call(this)},createField:function(a,e,d,b){var c=$.fb.formbuilder.prototype.options,g=$("#builderForm div.ctrlHolder").size();$('<a class="ui-corner-all closeButton" href="#"><span class="ui-icon ui-icon-close">delete this widget</span></a>').prependTo(e).click(function(i){var j=$(i.target).parent().parent(),
h=j.attr("rel");$("#builderForm div.ctrlHolder").size();j.find("input[id$='fields["+h+"].status']").val("D");j.hide();i.stopPropagation()});e.attr("rel",g);e.append($.fb.fbWidget.prototype._createFieldProperties(a,d,b,g));$(c._emptyBuilderPanel+":visible").hide();$(c._builderForm).append(e).sortable("refresh")},propertyName:function(a){a=a.replace(/ /gi,"");return a=a.charAt(0).toLowerCase()+a.substring(1)},_createFieldProperties:function(a,e,d,b){a=$('<div class="fieldProperties"> \t\t<input type="hidden" id="fields['+
b+'].name" name="fields['+b+'].name" value="'+a+'" /> \t\t<input type="hidden" id="fields['+b+'].type" name="fields['+b+'].type" value="'+e.type+'" /> \t\t<input type="hidden" id="fields['+b+'].settings" name="fields['+b+'].settings" /> \t\t<input type="hidden" id="fields['+b+'].sequence" name="fields['+b+'].sequence" value="'+b+'" /> \t\t<input type="hidden" id="fields['+b+'].status" name="fields['+b+'].status" /> \t\t</div>');a.find("input[id$='fields["+b+"].settings']").val($.toJSON(d));return a},
_updateStatus:function(a){$widget=$(a.target);$widget.parent().find("input:last").val("U")},createWidget:function(){alert("createWidget(event) should be overriden by subclass")}};$.widget("fb.fbWidget",FbWidget);
var FbPlainText=$.extend({},$.fb.fbWidget.prototype,{options:{type:"PlainText",name:"Plain Text",html:'<div class="ctrlHolder textHolder"><div class="text"></div></div>',belongsTo:$.fb.formbuilder.prototype.options._fancyFieldsPanel,settings:{en:{text:"Plain Text Value",classes:["leftAlign","topAlign"]},zh:{text:"\u7121\u683c\u5f0f\u6587\u5b57",classes:["rightAlign","topAlign"]},styles:{fontFamily:"none",color:"none",backgroundColor:"none"}}},_create:function(){$.fb.fbWidget.prototype._create.call(this)},
_init:function(){$.fb.fbWidget.prototype._init.call(this)},destroy:function(){$.fb.fbWidget.prototype.destroy.call(this)},createWidget:function(a){a=$(a.target).parent().data("fbPlainText");var e=$("div."+a.options.type).size()+1,d=a.propertyName(a.options.type+e),b=$("#language").val();e=a.options.settings[b].text+" "+e;var c=$(a.options.html).addClass(a.options.type).attr("id",d).click(a.getFieldSettings),g=jQuery.extend(true,{},a.options.settings);g[b].text=e;c.find("div.text").text(e).addClass(g[b].classes.join(" "));
a.createField(d,c,a.options,g)},getFieldSettings:function(a){var e=$(a.target).parent();a=$.fb.formbuilder.prototype.options;var d=e.attr("rel"),b=e.find("input[id$='fields["+d+"].settings']"),c=$.parseJSON(b.val()),g=$('<div class="clear labelOnTop"> \t\t<label for="text">Text (?)</label><br /> \t\t<input type="text" id="text" /> \t</div> \t<div class="2cols"> \t\t<div class="labelOnTop col1 noPaddingBottom"> \t\t\t<label for="horizontalAlignment">Horizontal Align (?)</label><br /> \t\t\t<select id="horizontalAlignment"> \t\t\t\t<option value="leftAlign">left</option> \t\t\t\t<option value="centerAlign">center</option> \t\t\t\t<option value="rightAlign">right</option> \t\t\t</select> \t\t</div> \t\t<div class="labelOnTop col2"> \t\t<label for="verticalAlignment">Vertical Align (?)</label><br /> \t\t\t<select id="verticalAlignment"> \t\t\t\t<option value="topAlign">top</option> \t\t\t\t<option value="middleAlign">middle</option> \t\t\t\t<option value="bottomAlign">bottom</option> \t\t\t</select> \t  </div> \t</div>'),
i=$(a._fieldSettingsLanguageSection),j=$("#language"),h=j.val();$("legend",i).text("Language: "+j.find("option:selected").text());g.find("input#text").val(e.find("div.text").text()).change(function(f){f=$(f.target).val();e.find("div.text").text(f);c[h].text=f;b.val($.toJSON(c)).trigger("change")});g.find("select#horizontalAlignment").val(c[h].classes[0]).change(function(f){var k=e.find("div.text");f=$(f.target).val();k.removeClass(c[h].classes[0]).addClass(f);c[h].classes[0]=f;b.val($.toJSON(c)).trigger("change")});
g.find("select#verticalAlignment").val(c[h].classes[1]).change(function(f){var k=e.find("div.text");f=$(f.target).val();k.removeClass(c[h].classes[1]).addClass(f);c[h].classes[1]=f;b.val($.toJSON(c)).trigger("change")});i.children(":not(legend)").remove();i.append(g);g=$('<div class="2cols"> \t\t<div class="labelOnTop col1 noPaddingBottom"> \t\t\t<label for="name">Name (?)</label><br/> \t\t  <input type="text" id="name" /> \t\t</div> \t</div>');g.find("input#name").val(e.find("input[id$='fields["+
d+"].name']").val()).change(function(f){e.find("input[id$='fields["+d+"].name']").val($(f.target).val()).trigger("change")});a=$(a._fieldSettingsGeneralSection);a.children().remove();a.append(g);$("#paletteTabs").tabs("select",1)}});$.widget("fb.fbPlainText",FbPlainText);
