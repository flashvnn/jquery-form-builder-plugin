/*
* jquery-form-builder-plugin - JQuery WYSIWYG Web Form Builder
* http://code.google.com/p/jquery-form-builder-plugin/
*
* Revision: 107
* Version: 0.1
* Copyright 2011 Lim Chee Kin (limcheekin@vobject.com)
*
* Licensed under Apache v2.0 http://www.apache.org/licenses/LICENSE-2.0.html
*
* Date: Fri Jan 28 17:19:17 GMT+08:00 2011 
*/
var FormBuilder={options:{fields:"PlainText",tabSelected:0,readOnly:false,tabDisabled:[],formCounter:1,settings:{en:{name:"Form",classes:["leftAlign"],heading:"h2",fontStyles:[1,0,0]},zh:{name:"\u8868\u683c",classes:["rightAlign"],heading:"h2",fontStyles:[1,0,0]},styles:{color:"default",backgroundColor:"default",fontFamily:"default",fontSize:"default"}},_id:"#container",_languages:["en","zh"],_builderPanel:"#builderPanel",_builderForm:"#builderForm",_emptyBuilderPanel:"#emptyBuilderPanel",_paletteTabs:"#paletteTabs",
_standardFieldsPanel:"#standardFields",_fancyFieldsPanel:"#fancyFields",_fieldSettingsPanel:"#fieldSettings",_fieldSettingsLanguageSection:"#fieldSettings fieldset.language:first",_fieldSettingsGeneralSection:"#fieldSettings div.general:first",_formSettingsLanguageSection:"#formSettings fieldset.language:first",_formSettingsGeneralSection:"#formSettings div.general:first",_languagesSupportIdGeneration:["en"],_dragBoxCss:{opacity:0.6,zIndex:8888,border:"5px solid #cccccc"},_formControls:"#builderPanel fieldset",
_draggableClass:"draggable",_dropPlaceHolderClass:"dropPlaceHolder"},_create:function(){this._log("FormBuilder._create called. this.options.widgets = "+this.options.widgets);this._initBrowserDefaultSettings();this._initBuilderPalette();this._initBuilderPanel()},_initBrowserDefaultSettings:function(){var a=$("html"),b=this.options;b._fontFamily=a.css("fontFamily");b._fontSize=a.css("fontSize");b._color=a.css("color");b._backgroundColor=a.css("backgroundColor");a=b._fontSize.lastIndexOf("px");if(a>
-1)b._fontSize=b._fontSize.substring(0,a)},_initBuilderPalette:function(){$(window).scroll(function(){if($(window).scrollTop()>$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","fixed");$(".floatingPanel").css("top","0")}if($(window).scrollTop()<=$(".floatingPanelIdentifier").position({scroll:false}).top){$(".floatingPanel").css("position","relative");$(".floatingPanel").css("top",$(".floatingPanelIdentifier").position)}});$(this.options._paletteTabs).tabs({selected:this.options.tabSelected,
disabled:this.options.tabDisabled,select:this._isFieldSettingsTabCanOpen});var a=this.options.fields;a=a.split(",");var b=a.length,c,d,e;for(e=0;e<b;e++){c=$.fb["fb"+$.trim(a[e])].prototype.options;d=$('<a id="'+c._type+'" href="#" class="fbWidget">'+c.name+"</a>");d.button()["fb"+c._type]().appendTo(c.belongsTo);this._initDraggable(d,c._type)}},_initDraggable:function(a,b){a.draggable({cursor:"move",distance:10,helper:function(c){c=$(this).data("fb"+b)._createFbWidget(c).css($.fb.formbuilder.prototype.options._dragBoxCss).css({width:$(".formHeading").css("width")}).addClass($.fb.formbuilder.prototype.options._draggableClass);
$.fb.formbuilder.prototype._log("helper.html() = "+c.html());return c},drag:function(c,d){$.fb.formbuilder.prototype._log("ui.helper: w x h = "+d.helper.css("width")+" x "+d.helper.css("height"));var e=$.fb.formbuilder.prototype._getPreviousCtrlHolder(d),f=$.fb.formbuilder.prototype.options;if(e&&e.attr("rel")!=d.helper.attr("rel")){d.helper.attr("rel",e.attr("rel"));$("."+f._dropPlaceHolderClass).remove();$("<div></div>").addClass(f._dropPlaceHolderClass).css("height","30px").insertAfter(e)}else{e=
$("."+$.fb.fbWidget.prototype.options._styleClass+":visible:not(."+f._draggableClass+"):first");e.length&&d.offset.top<e.offset().top&&$("."+f._dropPlaceHolderClass).remove()}},stop:function(){$("."+$.fb.formbuilder.prototype.options._dropPlaceHolderClass).remove()}})},_isFieldSettingsTabCanOpen:function(a,b){if(b.index==1){var c=$.fb.formbuilder.prototype.options;$(this).tabs("select",0);if($(c._emptyBuilderPanel).is(":visible")){$(c._standardFieldsPanel).qtip({content:"No field was created. Please select standard field or fancy field.",
position:{my:"bottom left",at:"top center"},show:{event:false,ready:true,effect:function(){$(this).show("drop",{direction:"up"})}},hide:{target:$(c._standardFieldsPanel+", "+c._fancyFieldsPanel)},style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}});return false}else if($(c._builderForm+" ."+$.fb.fbWidget.prototype.options._selectedClass).length===0){$("."+$.fb.fbWidget.prototype.options._styleClass+":first").qtip({content:"Please select field below to see it's Field Settings.",
position:{my:"bottom center",at:"top center"},show:{event:false,ready:true,effect:function(){$(this).show("drop",{direction:"up"})}},hide:"click",style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}});return false}}},_initBuilderPanel:function(){this._initFormSettings();if(this.options.readOnly){$("input:not(div.buttons input)").attr("disabled",true);$("select").attr("disabled",true);$("textarea").attr("disabled",true)}else{this._initSortableWidgets();this._initDroppable()}this._initWidgetsEventBinder()},
_initDroppable:function(){var a=this.options,b=$(a._formControls);b.droppable({drop:function(c,d){$.fb.formbuilder.prototype._log("drop executing. ui.helper.attr(rel) = "+d.helper.attr("rel")+", ui.offset.top = "+d.offset.top);$.fb.formbuilder.prototype._log("ui.draggable.attr(id) = "+d.draggable.attr("id"));if(d.helper.attr("class").lastIndexOf(a._draggableClass)>-1){$("."+a._dropPlaceHolderClass).remove();var e=d.draggable.data("fb"+d.draggable.attr("id")),f=$.fb.formbuilder.prototype._getPreviousCtrlHolder(d),
g=e._createFbWidget(c);if(f){e._log("$prevCtrlHolder.text() = "+f.text());g.insertAfter(f);f=f.next().nextAll()}else{$(a._emptyBuilderPanel+":visible").hide();f=$("."+$.fb.fbWidget.prototype.options._styleClass+":visible:not(."+a._draggableClass+")",b);b.prepend(g).sortable("refresh")}g.toggle("slide",{direction:"up"},"slow");if(f.length){e._log("$elements.first().text() = "+f.first().text());$.fb.formbuilder.prototype._getSequence(g).val($.fb.formbuilder.prototype._getSequence(f.first()).val()).change();
f.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))})}}}})},_getPreviousCtrlHolder:function(a){var b,c;$("."+$.fb.fbWidget.prototype.options._styleClass+":visible:not(."+$.fb.formbuilder.prototype.options._draggableClass+")").each(function(d){b=$(this);$.fb.formbuilder.prototype._log(d+") top = "+b.offset().top);if(a.offset.top>b.offset().top)c=b;else return false});return c},_initFormSettings:function(){var a=$.fb.fbWidget.prototype,b=$(this.options._builderPanel),c=$(this.options._builderForm),
d=$(this.options._formSettingsLanguageSection),e=$(this.options._formSettingsGeneralSection),f=$("#language",d).change(this._languageChange),g=this.options,h,i=this,j=$(".formHeading",b),l=$("#settings",c);if(l.val()==""){h=g.settings[f.val()];for(l=0;l<g._languages.length;l++)g.settings[g._languages[l]].name+=" "+g.formCounter;j.append("<"+h.heading+' class="heading">'+h.name+"</"+h.heading+">");$("#name",c).val(a._propertyName(h.name));i._updateSettings(i)}else{g.settings=$.parseJSON(unescape(l.val()));
h=g.settings[f.val()]}a._log("settings.name = "+h.name);l=a._label({label:"Name",name:"form.name"}).append('<input type="text" id="form.name" value="'+h.name+'" />');$("input",l).keyup(function(){var k=$(this).val();if($.inArray(f.val(),g._languagesSupportIdGeneration)>-1){var q=a._propertyName(k);$("#name",c).val(q).change()}a._log("$(this).val() = "+k);h.name=k;$(h.heading,j).text(k);i._updateSettings(i)});var n=$('<select> \t\t\t\t\t<option value="h1">Heading 1</option> \t\t\t\t\t<option value="h2">Heading 2</option> \t\t\t\t\t<option value="h3">Heading 3</option> \t\t\t\t\t<option value="h4">Heading 4</option> \t\t\t\t\t<option value="h5">Heading 5</option> \t\t\t\t\t<option value="h6">Heading 6</option> \t\t\t\t</select>').css("marginTop",
"1em").val(h.heading).attr("id","form.heading").change(function(){var k=$(this).val(),q=$(h.heading,j).text();q=$("<"+k+' class="heading">'+q+"</"+k+">");h.fontStyles[0]===0&&q.css("fontWeight","normal");h.fontStyles[1]==1&&q.css("fontStyle","italic");h.fontStyles[2]==1&&q.css("textDecoration","underline");$(h.heading,j).replaceWith(q);h.heading=k;i._updateSettings(i)}),r=a._horizontalAlignment({name:"form.horizontalAlignment",value:h.classes[0]});$("select",r).change(function(){var k=$(this).val();
j.removeClass(h.classes[0]).addClass(k);h.classes[0]=k;i._updateSettings(i)});var o=a._fontStyles({names:["form.bold","form.italic","form.underline"],checked:h.fontStyles}).css("paddingLeft","3em");$("input[id$='form.bold']",o).change(function(){if($(this).attr("checked")){$(h.heading,j).css("fontWeight","bold");h.fontStyles[0]=1}else{$(h.heading,j).css("fontWeight","normal");h.fontStyles[0]=0}i._updateSettings(i)});$("input[id$='form.italic']",o).change(function(){if($(this).attr("checked")){$(h.heading,
j).css("fontStyle","italic");h.fontStyles[1]=1}else{$(h.heading,j).css("fontStyle","normal");h.fontStyles[1]=0}i._updateSettings(i)});$("input[id$='form.underline']",o).change(function(){if($(this).attr("checked")){$(h.heading,j).css("textDecoration","underline");h.fontStyles[2]=1}else{$(h.heading,j).css("textDecoration","none");h.fontStyles[2]=0}i._updateSettings(i)});var p=g.settings.styles.fontFamily;if(p=="default")p=g._fontFamily;p=a._fontPicker({name:"form.fontFamily",value:p});$("input[id$='form.fontFamily']",
p).change(function(){var k=$(this).val();b.css("fontFamily",k);g.settings.styles.fontFamily=k;i._updateSettings(i)});var m=g.settings.styles.fontSize;if(m=="default")m=g._fontSize;m=a._fontSize({label:"Size",name:"form.fontSize",value:m});$("select[id$='form.fontSize']",m).change(function(){var k=$(this).val();b.css("fontSize",k+"px");g.settings.styles.fontSize=k;i._updateSettings(i)});p=a._twoColumns(p,m);p.find(".col2").addClass("noPaddingBottom").css("marginLeft","60%");m=g.settings.styles.color;
if(m=="default")m=g._color;var s=g.settings.styles.backgroundColor;if(s=="default")s=g._backgroundColor;m=a._colorPanel({color:m,backgroundColor:s,idPrefix:"form."});$("input[id$='form.color']",m).change(function(){var k=$(this).data("colorPicker").color;b.css("color","#"+k);g.settings.styles.color=k;i._updateSettings(i)});$("input[id$='form.backgroundColor']",m).change(function(){var k=$(this).data("colorPicker").color;i._log("background color change: value "+k);b.css("backgroundColor","#"+k);g.settings.styles.backgroundColor=
k;i._updateSettings(i)});d.append(a._oneColumn(l)).append(a._twoRowsOneRow(n,r,o));e.append(a._fieldset({text:"Fonts"}).append(p)).append(m)},_languageChange:function(a){$.fb.formbuilder.prototype._log("languageChange("+$(this).val()+", "+$("option:selected",this).text()+")");var b=$.fb.fbWidget.prototype._getFbOptions(),c=$("."+$.fb.fbWidget.prototype.options._styleClass+":visible"),d=$(this).val(),e=$("option:selected",this).text(),f=b.settings[d],g=$(".formHeading"),h=$(b._formSettingsLanguageSection),
i,j,l,n;$("input[id$='form.name']",h).val(f.name);$("select[id$='form.heading'] option[value='"+f.heading+"']",h).attr("selected","true");var r=$("<"+f.heading+' class="heading">'+f.name+"</"+f.heading+">").css("fontWeight",f.fontStyles[0]==1?"bold":"normal").css("fontStyle",f.fontStyles[1]==1?"italic":"normal").css("textDecoration",f.fontStyles[2]==1?"underline":"none");$(".heading",g).replaceWith(r);$.fb.formbuilder.prototype._log("formSettings.fontStyles[2] = "+f.fontStyles[2]);$("input[id$='form.bold']",
h).attr("checked",f.fontStyles[0]);$("input[id$='form.italic']",h).attr("checked",f.fontStyles[1]);$("input[id$='form.underline']",h).attr("checked",f.fontStyles[2]);g.removeClass("leftAlign centerAlign rightAlign").addClass(f.classes[0]);$("select[id$='form.horizontalAlignment'] option[value='"+f.classes[0]+"']",h).attr("selected","true");c.each(function(){var o=$(this);(l=o.attr("class").indexOf($.fb.fbWidget.prototype.options._selectedClass)>-1)&&$(b._fieldSettingsLanguageSection+" legend").text("Language: "+
e);i=o.data("fbWidget");j=o.find("input[id$='fields["+o.attr("rel")+"].type']").val();$.fb.formbuilder.prototype._log("type = "+j);$this=$("#"+j).data("fb"+j);n={target:$this,item:o,settings:i[d]};n.item.selected=l;$this._languageChange(a,n)})},_updateSettings:function(a){a._log("_updateSettings = "+$.toJSON(a.options.settings));$("#settings").val($.toJSON(a.options.settings)).change()},_initWidgetsEventBinder:function(){var a=$("."+$.fb.fbWidget.prototype.options._styleClass);if(a.size()>0){var b,
c,d=["name","settings","sequence"];$(this.options._emptyBuilderPanel+":visible").hide();a.each(function(e){b=$(this);c=b.find("input[id$='fields["+e+"].type']").val();b.click($.fb["fb"+c].prototype._createFieldSettings);for(var f=0;f<d.length;f++)b.find("input[id$='fields["+e+"]."+d[f]+"']").change($.fb.fbWidget.prototype._updateStatus)});this.options.readOnly||a.find(".closeButton").click($.fb.fbWidget.prototype._deleteWidget)}},_initSortableWidgets:function(){var a=$(this.options._formControls);
a.sortable({axis:"y",cursor:"move",distance:10,helper:function(b,c){return $(c).clone().css($.fb.formbuilder.prototype.options._dragBoxCss)},start:function(b,c){var d=$(c.item).prev();if(d.attr("rel")){c.item.prevIndex=d.attr("rel");c.item.originalOffsetTop=d.offset().top}},update:$.fb.formbuilder.prototype._updateSequence});a.disableSelection()},_updateSequence:function(a,b){var c=$(b.item),d;d=b.offset.top>b.item.originalOffsetTop;$.fb.formbuilder.prototype._log("moveDown = "+d+", ui.offset.top = "+
b.offset.top+", ui.item.originalOffsetTop = "+b.item.originalOffsetTop);if(b.item.prevIndex){var e='[rel="'+b.item.prevIndex+'"]';if(d){d=c.prevUntil(e);$.fb.formbuilder.prototype._moveDown(c,d)}else{$.fb.formbuilder.prototype._getSequence(c).val($.fb.formbuilder.prototype._getSequence(c.next()).val()).change();d=c.nextUntil(e);d.each(function(){$.fb.formbuilder.prototype._increaseSequence($(this))});$.fb.formbuilder.prototype._increaseSequence($(e))}}else{d=c.prevAll();$.fb.formbuilder.prototype._moveDown(c,
d)}},_init:function(){this._log("FormBuilder._init called.");this.method1("calling from FormBuilder._init")},destroy:function(){this._log("FormBuilder.destroy called.");$.Widget.prototype.destroy.call(this)},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_moveDown:function(a,b){$.fb.formbuilder.prototype._getSequence(a).val($.fb.formbuilder.prototype._getSequence(a.prev()).val()).change();b.each(function(){$.fb.formbuilder.prototype._decreaseSequence($(this))})},_getSequence:function(a){return a.find("input[id$='fields["+
a.attr("rel")+"].sequence']")},_increaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()*1+1);a.change()}},_decreaseSequence:function(a){if(a.is(":visible")){a=$.fb.formbuilder.prototype._getSequence(a);a.val(a.val()-1);a.change()}},method1:function(a){this._log("FormBuilder.method1 called. params = "+a)}};$.widget("fb.formbuilder",FormBuilder);
var ColorPicker={options:{name:"jquery-color-picker",value:"",ico:"ico.gif",disabledIco:"ico.gif",title:"Pick a colour",inputBG:true,showColorCode:false,speed:500,openTxt:"Open colour picker",type:"basic",width:180,basicColors:["ffffff","ffccc9","ffce93","fffc9e","ffffc7","9aff99","96fffb","cdffff","cbcefb","cfcfcf","fd6864","fe996b","fffe65","fcff2f","67fd9a","38fff8","68fdff","9698ed","c0c0c0","fe0000","f8a102","ffcc67","f8ff00","34ff34","68cbd0","34cdf9","6665cd","9b9b9b","cb0000","f56b00","ffcb2f",
"ffc702","32cb00","00d2cb","3166ff","6434fc","656565","9a0000","ce6301","cd9934","999903","009901","329a9d","3531ff","6200c9","343434","680100","963400","986536","646809","036400","34696d","00009b","303498","000000","330001","643403","663234","343300","013300","003532","010066","340096"],webSafeColors:["000000","000033","000066","000099","0000CC","0000FF","003300","003333","003366","003399","0033CC","0033FF","006600","006633","006666","006699","0066CC","0066FF","009900","009933","009966","009999",
"0099CC","0099FF","00CC00","00CC33","00CC66","00CC99","00CCCC","00CCFF","00FF00","00FF33","00FF66","00FF99","00FFCC","00FFFF","330000","330033","330066","330099","3300CC","3300FF","333300","333333","333366","333399","3333CC","3333FF","336600","336633","336666","336699","3366CC","3366FF","339900","339933","339966","339999","3399CC","3399FF","33CC00","33CC33","33CC66","33CC99","33CCCC","33CCFF","33FF00","33FF33","33FF66","33FF99","33FFCC","33FFFF","660000","660033","660066","660099","6600CC","6600FF",
"663300","663333","663366","663399","6633CC","6633FF","666600","666633","666666","666699","6666CC","6666FF","669900","669933","669966","669999","6699CC","6699FF","66CC00","66CC33","66CC66","66CC99","66CCCC","66CCFF","66FF00","66FF33","66FF66","66FF99","66FFCC","66FFFF","990000","990033","990066","990099","9900CC","9900FF","993300","993333","993366","993399","9933CC","9933FF","996600","996633","996666","996699","9966CC","9966FF","999900","999933","999966","999999","9999CC","9999FF","99CC00","99CC33",
"99CC66","99CC99","99CCCC","99CCFF","99FF00","99FF33","99FF66","99FF99","99FFCC","99FFFF","CC0000","CC0033","CC0066","CC0099","CC00CC","CC00FF","CC3300","CC3333","CC3366","CC3399","CC33CC","CC33FF","CC6600","CC6633","CC6666","CC6699","CC66CC","CC66FF","CC9900","CC9933","CC9966","CC9999","CC99CC","CC99FF","CCCC00","CCCC33","CCCC66","CCCC99","CCCCCC","CCCCFF","CCFF00","CCFF33","CCFF66","CCFF99","CCFFCC","CCFFFF","FF0000","FF0033","FF0066","FF0099","FF00CC","FF00FF","FF3300","FF3333","FF3366","FF3399",
"FF33CC","FF33FF","FF6600","FF6633","FF6666","FF6699","FF66CC","FF66FF","FF9900","FF9933","FF9966","FF9999","FF99CC","FF99FF","FFCC00","FFCC33","FFCC66","FFCC99","FFCCCC","FFCCFF","FFFF00","FFFF33","FFFF66","FFFF99","FFFFCC","FFFFFF"],customColors:[],disabled:false},_init:function(){var a=this.options.disabled?this.options.disabledIco:this.options.ico;this._log("ColorPicker._init called.");this.element.append('<input type="text" id="'+this.options.name+'" name="'+this.options.name+'" /> \t\t\t\t<a class="floatLeft" href="#" rel="'+
this.options.name+'"> \t\t\t\t<img border="0" src="'+a+'" alt="'+this.options.openTxt+'"/></a>');a=$("input",this.element).attr("readonly",true);var b=this.element.data("colorPicker"),c="colorpicker_"+this.options.type;b.options.showColorCode?a.val(this.options.value):a.attr("disabled","true");a.data("colorPicker",{color:this.options.value});var d=$("#"+c);if(d.length==0&&!this.options.disabled){for(var e="",f=this.options[this.options.type+"Colors"],g,h=0;h<f.length;h++){g=f[h];if(g!="")e+='<li><a href="#" title="'+
g+'" rel="'+g+'" style="background: #'+g+"; color: "+this._hexInvert(g)+';">'+g+"</a></li>"}d=$('<div id="'+c+'" class="colorPicker">'+(this.options.title?"<h2>"+this.options.title+"</h2>":"")+"<ul>"+e+"</ul></div>").appendTo(document.body).hide();$(document.body).click(function(j){$(j.target).is(".colorPicker")||$(j.target).parents(".colorPicker").length||d.hide(b.options.speed)})}if(this.options.inputBG){c=this.options.value;if(c.length==6)c="#"+c;a.css({background:c,color:"#"+this._hexInvert(c)})}if(!this.options.disabled){var i=
$("a",this.element);i.click(function(){var j=i.offset();d.css({position:"absolute",left:j.left+"px",top:j.top+"px",width:b.options.width+"px"}).show(b.options.speed).attr("rel",i.attr("rel"));return false})}$("a",d).click(function(j){var l=$("input[id$='"+d.attr("rel")+"']"),n=$(this).attr("rel");$.fb.colorPicker.prototype._log("colorPicker. input id = "+d.attr("rel")+", hex = "+n+", title = "+$(this).attr("title")+", text = "+$(this).text());var r=l.parent().data("colorPicker").options;r.showColorCode&&
l.val(n);l.data("colorPicker",{color:n});r.inputBG&&l.css({background:"#"+n,color:"#"+b._hexInvert(n)});l.change();d.hide(b.options.speed);j.stopImmediatePropagation();return false})},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_hexInvert:function(a){var b=a.substr(0,2),c=a.substr(2,2);a=a.substr(4,2);return 0.212671*b+0.71516*c+0.072169*a<0.5?"ffffff":"000000"}};$.widget("fb.colorPicker",ColorPicker);
var FontPicker={fonts:Array("Arial,Arial,Helvetica,sans-serif","Arial Black,Arial Black,Gadget,sans-serif","Comic Sans MS,Comic Sans MS,cursive","Courier New,Courier New,Courier,monospace","Georgia,Georgia,serif","Impact,Charcoal,sans-serif","Lucida Console,Monaco,monospace","Lucida Sans Unicode,Lucida Grande,sans-serif","Palatino Linotype,Book Antiqua,Palatino,serif","Tahoma,Geneva,sans-serif","Times New Roman,Times,serif","Trebuchet MS,Helvetica,sans-serif","Verdana,Geneva,sans-serif"),options:{defaultFont:"Tahoma",
id:"fontbox",name:"fontPickerInput",selClass:"fontPicker",fontclass:"singlefont",speed:100,hoverColor:"#efefff",bgColor:"#ffffee",disabled:false},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_init:function(){var a=this.options,b=$("#"+a.id);this.element.parent().append('<input type="hidden" id="'+a.name+'" value="'+a.defaultFont+'" />');if(!b.length&&!a.disabled){b=$('<div id="'+a.id+'" ></div>').appendTo(document.body).hide();$(document.body).click(function(c){$(c.target).is("."+
a.selClass)||$(c.target).is("#"+a.id)||b.slideUp(a.speed)})}a.disabled||this.element.click(function(){if(b.is(":hidden")){var c=$(this);b.css({position:"absolute",left:c.offset().left+"px",top:c.offset().top+c.height()+3+"px"}).attr("rel",c.attr("rel"));b.slideDown(a.speed)}else b.slideUp(a.speed)});if(a.defaultFont.length){this.element.css("fontFamily",a.defaultFont);this.element.text(a.defaultFont)}$.each(this.fonts,function(c,d){b.append('<div class="singlefont" onmouseover="this.style.backgroundColor=\''+
a.hoverColor+"'\" onmouseout=\"this.style.backgroundColor='"+a.bgColor+'\'" style="font-family: '+d+';" value="'+d+'"> '+d.split(",")[0]+"</div>")});$("."+a.fontclass).click(function(c){var d=$(this),e=$("input[id$='"+d.parent().attr("rel")+"']"),f=d.attr("value");e.prev().text(d.text()).css("fontFamily",f);e.val(f).change();b.slideUp(a.speed);c.stopImmediatePropagation()})}};$.widget("fb.fontPicker",FontPicker);
var FbWidget={options:{_styleClass:"ctrlHolder",_selectedClass:"ctrlHolderSelected"},_log:function(a){window.console&&window.console.log&&window.console.log(a)},_create:function(){this._log("FbWidget._create called.")},_init:function(){this._log("FbWidget._init called.");this.element.click(this._createFbWidget)},destroy:function(){this._log("FbWidget.destroy called.");this.element.button("destroy");$.Widget.prototype.destroy.call(this)},_getFbOptions:function(){return $($.fb.formbuilder.prototype.options._id).formbuilder("option")},
_createField:function(a,b,c,d){var e=$.fb.formbuilder.prototype.options,f=$("#builderForm div.ctrlHolder").size();$('<a class="ui-corner-all closeButton" href="#"><span class="ui-icon ui-icon-close">delete this widget</span></a>').prependTo(b).click($.fb.fbWidget.prototype._deleteWidget).mouseover(function(){$("span",this).removeClass("ui-icon-close").addClass("ui-icon-circle-close")}).mouseout(function(){$("span",this).removeClass("ui-icon-circle-close").addClass("ui-icon-close")});b.attr("rel",
f);b.append($.fb.fbWidget.prototype._createFieldProperties(a,c,d,f));$(e._emptyBuilderPanel+":visible").hide()},_propertyName:function(a){a=a.replace(/ /gi,"");return a=a.charAt(0).toLowerCase()+a.substring(1)},_deleteWidget:function(a){var b=$(a.target).parent().parent(),c=b.attr("rel"),d=$.fb.fbWidget.prototype.options,e=$.fb.formbuilder.prototype.options;if(b.find("input[id$='fields["+c+"].id']").val()=="null")b.remove();else{b.find("input[id$='fields["+c+"].status']").val("D");b.hide()}c=$("."+
d._styleClass+":visible");$.fb.fbWidget.prototype._log("_deleteWidget(). $ctrlHolders.size() = "+c.size());b.attr("class").indexOf(d._selectedClass)>-1&&$(e._paletteTabs).tabs("select",0);c.size()===0&&$(e._emptyBuilderPanel).show();a.stopPropagation()},_createFieldProperties:function(a,b,c,d){var e="fields["+d+"].";a=$('<div class="fieldProperties"> \t\t<input type="hidden" id="'+e+'id" name="'+e+'id" value="null" /> \t\t<input type="hidden" id="'+e+'name" name="'+e+'name" value="'+a+'" /> \t\t<input type="hidden" id="'+
e+'type" name="'+e+'type" value="'+b._type+'" /> \t\t<input type="hidden" id="'+e+'settings" name="'+e+'settings" /> \t\t<input type="hidden" id="'+e+'sequence" name="'+e+'sequence" value="'+d+'" /> \t\t<input type="hidden" id="'+e+'status" name="'+e+'status" /> \t\t</div>');a.find("input[id$='"+e+"settings']").val($.toJSON(c));return a},_updateStatus:function(a){$widget=$(a.target);$.fb.fbWidget.prototype._log($widget.attr("id")+" updated");if($widget.parent().find("input:first").val()!="null"){$.fb.fbWidget.prototype._log("field status updated");
$widget.parent().find("input:last").val("U")}},_createFbWidget:function(a){$.fb.fbWidget.prototype._log("_createFbWidget executing. event.type = "+a.type);var b;if(this.options)b=this;else{b="fb"+$(this).fbWidget("option","_type");$.fb.fbWidget.prototype._log("type = "+b);b=$(this).data(b)}for(var c=jQuery.extend(true,{},b.options.settings),d=b._getCounter(b),e=b.options._languages,f=0;f<e.length;f++){c[e[f]][b.options._counterField]+=" "+d;b._log(c[e[f]][b.options._counterField])}e=$('<div class="'+
b.options._styleClass+'"></div>').hide();e.data("fbWidget",c);b._log("b4. text = "+c[$("#language").val()].text);f={target:b,item:e,settings:c[$("#language").val()]};f=b._getWidget(a,f);b._log("at. text = "+c[$("#language").val()].text);e.append(f);if(a.type=="click"||a.type=="drop"){d=b._propertyName(b.options._type+d);f.click(b._createFieldSettings);b._createField(d,e,b.options,c);if(a.type=="click"){$($.fb.formbuilder.prototype.options._formControls).append(e).sortable("refresh");e.toggle("slide",
{direction:"up"},"slow")}else return e}else return e.show();b._log("_createFbWidget executed")},_createFieldSettings:function(a){$.fb.fbWidget.prototype._log("_createFieldSettings executing.");var b=$(this),c=$.fb.fbWidget.prototype.options._selectedClass;b=b.attr("class").indexOf($.fb.fbWidget.prototype.options._styleClass)>-1?b:b.parent();b.parent().find("."+c).removeClass(c);b.addClass(c);c=b.find("input[id$='fields["+b.attr("rel")+"].type']").val();$.fb.fbWidget.prototype._log("type = "+c);c=
$("#"+c).data("fb"+c);var d=c._getFbOptions();c._log("$widget.text() = "+b.text()+", fbOptions.readOnly = "+d.readOnly);if(!b.data("fbWidget")){var e=b.find("input[id$='fields["+b.attr("rel")+"].settings']");c._log("_createFieldSettings. unescaped settings = "+unescape(e.val()));b.data("fbWidget",$.parseJSON(unescape(e.val())))}e=b.data("fbWidget");var f=$(d._fieldSettingsLanguageSection),g=$("#language");$("legend",f).text("Language: "+g.find("option:selected").text());g={target:c,item:b,settings:e[g.val()]};
g=c._getFieldSettingsLanguageSection(a,g);f.children(":not(legend)").remove();for(var h=0;h<g.length;h++)f.append(g[h]);g=c._getFieldSettingsGeneralSection(a,{target:c,item:b,settings:e});c._log("fieldSettings.length = "+g.length);a=$(d._fieldSettingsGeneralSection);a.children().remove();for(h=0;h<g.length;h++){c._log(g[h].html());a.append(g[h])}if(d.readOnly){var i=$(d._fieldSettingsPanel);$("input",i).attr("disabled",true);$("select",i).attr("disabled",true);$("textarea",i).attr("disabled",true)}$(d._paletteTabs).tabs("select",
1);$("input:first",i).focus();$.fb.fbWidget.prototype._log("_createFieldSettings executed.")},_getCounter:function(a){var b=$("."+a.options._styleClass+":visible:not(."+this._getFbOptions()._draggableClass+")"),c=1;if(b.size()>0){var d,e,f,g=0,h=a._propertyName(a.options._type);b.each(function(){d=$(this);e=d.attr("rel");f=d.find("input[id$='fields["+e+"].name']").val();if(f.indexOf(h)>-1){g=f.substring(h.length)*1;a._log("widgetCounter = "+g);if(g>c)c=g}});g>0&&c++}a._log("counter = "+c);return c},
_updateSettings:function(a){var b=a.data("fbWidget");this._log("_updateSettings: \n"+$.toJSON(b));a.find("input[id$='fields["+a.attr("rel")+"].settings']").val($.toJSON(b)).change()},_twoColumns:function(a,b){return $('<div class="2cols"></div>').append(a.addClass("labelOnTop col1 noPaddingBottom")).append(b.addClass("labelOnTop col2"))},_oneColumn:function(a){return a.addClass("clear labelOnTop")},_help:function(a){var b;if(a.description){b=$('<span>&nbsp;(<a href="#" title="'+a.description+'">?</a>)</span>');
a=$("a",b);a.qtip({content:a.attr("title"),position:{my:"bottom left",at:"top center"},show:{event:"click",effect:function(){$(this).show("drop",{direction:"up"})}},hide:"mouseout",style:{widget:true,classes:"ui-tooltip-shadow ui-tooltip-rounded",tip:true}})}return b},_label:function(a){var b=$('<div><label for="'+a.name+'">'+a.label+"</label></div>").append(this._help(a));a.nobreak||b.append("<br />");return b},_horizontalAlignment:function(a){a=$.extend({},a);a.label=a.label?a.label:"Horizontal Align";
var b=this._label(a).append('<select> \t\t\t<option value="leftAlign">left</option> \t\t\t<option value="centerAlign">center</option> \t\t\t<option value="rightAlign">right</option> \t\t</select>');$("select",b).val(a.value).attr("id",a.name);return b},_verticalAlignment:function(a){a=$.extend({},a);a.label=a.label?a.label:"Vertical Align";var b=this._label(a).append('<select> \t\t\t\t<option value="topAlign">top</option> \t\t\t\t<option value="middleAlign">middle</option> \t\t\t\t<option value="bottomAlign">bottom</option> \t\t\t</select></div>');
$("select",b).val(a.value).attr("id",a.name);return b},_name:function(a){var b=a.attr("rel"),c=$('<label for="field.name">Name (?)</label><br/>  \t\t\t\t  <input type="text" id="field.name" />');$("input[id$='field.name']",c).val(a.find("input[id$='fields["+b+"].name']").val()).keyup(function(d){a.find("input[id$='fields["+b+"].name']").val($(d.target).val()).change()});return c},_colorPicker:function(a){var b=this._label(a);!a.type||a.type=="basic"?b.colorPicker({name:a.name,value:a.value,ico:"../images/jquery.colourPicker.gif",
disabledIco:"../images/jquery.colourPicker.disabled.gif",title:"Basic Colors",disabled:this._getFbOptions().readOnly}):b.colorPicker({name:name,value:value,ico:"../images/jquery.colourPicker.gif",disabledIco:"../images/jquery.colourPicker.disabled.gif",title:"Web Safe Colors",type:"webSafe",width:360,disabled:this._getFbOptions().readOnly});return b},_fontPicker:function(a){a=$.extend({},a);this._log("fontPicker("+$.toJSON(a)+")");a.value=a.value.replace(/'/gi,"");a.value=a.value.split(",",1)[0];
a.value=a.value!="default"?a.value:this._getFbOptions().settings.styles.fontFamily;if(!a.label)a.label="Font";var b=this._label(a).append('<div class="fontPicker" rel="'+a.name+'"></div>');$(".fontPicker",b).fontPicker({name:a.name,defaultFont:a.value,disabled:this._getFbOptions().readOnly});return b},_fontSize:function(a){this._log("fontSize("+$.toJSON(a)+")");a.nobreak=true;var b=this._label(a).append('&nbsp;<select> \t\t    <option value="9">9</option> \t\t    <option value="10">10</option> \t\t    <option value="11">11</option> \t\t    <option value="12">12</option> \t\t    <option value="13">13</option> \t\t    <option value="14">14</option> \t\t    <option value="15">15</option> \t\t    <option value="16">16</option> \t\t    <option value="17">17</option> \t\t    <option value="18">18</option> \t\t    <option value="20">20</option> \t\t    <option value="22">22</option> \t\t    <option value="24">24</option> \t\t    <option value="28">28</option> \t\t    <option value="32">32</option> \t\t  </select>'),
c=$("select",b);a.value=="default"?c.val(this._getFbOptions().settings.styles.fontSize):c.val(a.value);c.attr("id",a.name);return b},_fontStyles:function(a){var b=a.names;a=a.checked;var c=$('<div> \t\t  <input type="checkbox" id="'+b[0]+'" />&nbsp;Bold<br /> \t    <input type="checkbox" id="'+b[1]+'" />&nbsp;Italic<br /> \t    <input type="checkbox" id="'+b[2]+'" />&nbsp;Underline \t  </div>');if(a)for(var d=0;d<a.length;d++)$("input[id$='"+b[d]+"']",c).attr("checked",a[d]);return c},_twoRowsOneRow:function(a,
b,c){var d=$('<div class="twoRowsOneRow"> \t\t\t    <div class="row1col1"> \t\t\t      <div class="row2col1"> \t\t\t      </div> \t\t\t    </div> \t\t\t    <div class="row1col2"> \t\t\t    </div> \t\t\t  </div>');$(".row1col1",d).prepend(a);$(".row2col1",d).append(b);$(".row1col2",d).append(c);return d},_fieldset:function(a){return $("<fieldset><legend>"+a.text+"</legend></fieldset>")},_fontPanel:function(a){var b=a.idPrefix?a.idPrefix:"",c=[b+"bold",b+"italic",b+"underline"];return this._fieldset({text:"Fonts"}).append(this._twoRowsOneRow(this._fontPicker({name:b+
"fontFamily",value:a.fontFamily}),this._fontSize({label:"Size",name:b+"fontSize",value:a.fontSize}),this._fontStyles({names:c,checked:a.fontStyles}).css("paddingLeft","2em")))},_colorPanel:function(a){a=$.extend({},a);a.idPrefix=a.idPrefix?a.idPrefix:"";if(a.color=="default")a.color=this._getFbOptions().settings.styles.color;if(a.backgroundColor=="default")a.backgroundColor=this._getFbOptions().settings.styles.backgroundColor;a=this._fieldset({text:"Colors"}).append(this._twoColumns(this._colorPicker({label:"Text",
name:a.idPrefix+"color",value:a.color}),this._colorPicker({label:"Background",name:a.idPrefix+"backgroundColor",value:a.backgroundColor})));a.find(".2cols .col2").addClass("noPaddingBottom");a.find("input:first").addClass("floatClearLeft");return a},_getWidget:function(){$.fb.fbWidget.prototype._log("getWidget(event, fb) should be overriden by subclass.")},_getFieldSettingsLanguageSection:function(){$.fb.fbWidget.prototype._log("getFieldSettingsLanguageSection(event, fb) should be overriden by subclass.")},
_getFieldSettingsGeneralSection:function(){$.fb.fbWidget.prototype._log("getFieldSettingsLanguageSection(event, fb) should be overriden by subclass.")},_languageChange:function(){$.fb.fbWidget.prototype._log("_languageChange(event, fb) should be overriden by subclass.")}};$.widget("fb.fbWidget",FbWidget);
var FbPlainText=$.extend({},$.fb.fbWidget.prototype,{options:{name:"Plain Text",belongsTo:$.fb.formbuilder.prototype.options._fancyFieldsPanel,_type:"PlainText",_html:'<div class="PlainText"></div>',_counterField:"text",_languages:["en","zh"],settings:{en:{text:"Plain Text",classes:["leftAlign","topAlign"]},zh:{text:"\u7121\u683c\u5f0f\u6587\u5b57",classes:["rightAlign","middleAlign"]},styles:{fontFamily:"default",fontSize:"default",fontStyles:[0,0,0],color:"default",backgroundColor:"default"}}},
_init:function(){$.fb.fbWidget.prototype._init.call(this);this.options=$.extend({},$.fb.fbWidget.prototype.options,this.options)},_getWidget:function(a,b){b.item.addClass(b.settings.classes[1]);return $(b.target.options._html).text(b.settings.text).addClass(b.settings.classes[0])},_getFieldSettingsLanguageSection:function(a,b){var c=b.target._label({label:"Text",name:"field.text",description:"Text entered below will display in the form."}).append('<input type="text" id="field.text" />');$("input",
c).val(b.item.find("div.PlainText").text()).keyup(function(){var f=$(this).val();b.item.find("div.PlainText").text(f);b.settings.text=f;b.target._updateSettings(b.item)});var d=b.target._verticalAlignment({name:"field.verticalAlignment",value:b.settings.classes[1]}).change(function(){var f=$("option:selected",this).val();b.target._log("field.verticalAlignment value = "+f);b.item.removeClass(b.settings.classes[1]).addClass(f);b.settings.classes[1]=f;b.target._updateSettings(b.item)}),e=b.target._horizontalAlignment({name:"field.horizontalAlignment",
value:b.settings.classes[0]}).change(function(){b.target._log("$horizontalAlignment change trigger");var f=b.item.find("div.PlainText"),g=$("option:selected",this).val();f.removeClass(b.settings.classes[0]).addClass(g);b.settings.classes[0]=g;b.target._updateSettings(b.item)});return[b.target._oneColumn(c),b.target._twoColumns(e,d)]},_getFieldSettingsGeneralSection:function(a,b){var c=b.settings.styles,d=b.target._getFbOptions().settings.styles,e=c.color!="default"?c.color:d.color,f=c.backgroundColor!=
"default"?c.backgroundColor:d.backgroundColor;d=b.target._fontPanel({fontFamily:c.fontFamily!="default"?c.fontFamily:d.fontFamily,fontSize:c.fontSize!="default"?c.fontSize:d.fontSize,fontStyles:c.fontStyles,idPrefix:"field."});e=b.target._colorPanel({color:e,backgroundColor:f,idPrefix:"field."});$("input[id$='field.bold']",d).change(function(){if($(this).attr("checked")){b.item.css("fontWeight","bold");c.fontStyles[0]=1}else{b.item.css("fontWeight","normal");c.fontStyles[0]=0}b.target._updateSettings(b.item)});
$("input[id$='field.italic']",d).change(function(){if($(this).attr("checked")){b.item.css("fontStyle","italic");c.fontStyles[1]=1}else{b.item.css("fontStyle","normal");c.fontStyles[1]=0}b.target._updateSettings(b.item)});$("input[id$='field.underline']",d).change(function(){if($(this).attr("checked")){b.item.css("textDecoration","underline");c.fontStyles[2]=1}else{b.item.css("textDecoration","none");c.fontStyles[2]=0}b.target._updateSettings(b.item)});$("input[id$='field.fontFamily']",d).change(function(){var g=
$(this).val();b.item.css("fontFamily",g);c.fontFamily=g;b.target._updateSettings(b.item)});$("select[id$='field.fontSize']",d).change(function(){var g=$(this).val();b.item.css("fontSize",g+"px");c.fontSize=g;b.target._updateSettings(b.item)});$("input[id$='field.color']",e).change(function(){var g=$(this).data("colorPicker").color;b.item.css("color","#"+g);c.color=g;b.target._updateSettings(b.item)});$("input[id$='field.backgroundColor']",e).change(function(){var g=$(this).data("colorPicker").color;
b.item.css("backgroundColor","#"+g);c.backgroundColor=g;b.target._updateSettings(b.item)});return[d,e]},_languageChange:function(a,b){this._log("languageChange = "+$.toJSON(b.settings));b.item.find("div.PlainText").text(b.settings.text).removeClass("leftAlign centerAlign rightAlign").addClass(b.settings.classes[0]);b.item.removeClass("topAlign middleAlign bottomAlign").addClass(b.settings.classes[1]);if(b.item.selected){var c=$(this._getFbOptions()._fieldSettingsLanguageSection);$("input[id$='field.text']",
c).val(b.settings.text);$("select[id$='field.horizontalAlignment'] option[value='"+b.settings.classes[0]+"']",c).attr("selected","true");$("select[id$='field.verticalAlignment'] option[value='"+b.settings.classes[1]+"']",c).attr("selected","true")}}});$.widget("fb.fbPlainText",FbPlainText);
